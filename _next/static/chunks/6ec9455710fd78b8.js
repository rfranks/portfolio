(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,73799,e=>{"use strict";e.s(["default",()=>N],73799);var r=e.i(43476),t=e.i(57172),a=e.i(71645),n=e.i(57512);let s=[],o="#6CA6CD",u="url('".concat(n.BASE_PATH,"/assets/shooting-gallery/PNG/HUD/crosshair_red_small.png') 16 16, auto"),l="url('".concat(n.BASE_PATH,"/assets/shooting-gallery/PNG/Objects/shot_brown_large.png') 16 16, auto");var i=e.i(63665);let c=e=>{let{onStart:t,titleSrc:a,backgroundColor:n,cursor:s}=e;return(0,r.jsx)(i.default,{position:"relative",width:"100vw",height:"100dvh",sx:{backgroundColor:n,cursor:s},display:"flex",justifyContent:"center",alignItems:"center",onClick:t,children:(0,r.jsx)(i.default,{component:"img",src:a,alt:"Warbirds",sx:{width:"auto",height:"100%",cursor:s}})})},m="/assets/shooting-gallery/PNG/HUD/text_",h=["/assets/tappyplane/PNG/Planes/planeBlue1.png","/assets/tappyplane/PNG/Planes/planeGreen1.png","/assets/tappyplane/PNG/Planes/planeRed1.png"],g=["green","red"],d=function(e){var t,a;let{ui:s,canvasRef:o,handleClick:l,handleContext:c,resetGame:g,getImg:d}=e,{ammo:p,medalCount:f,duckCount:x,enemyCount:y,score:w,crashed:v,frameCount:C,activePowerups:b,cursor:k,phase:I}=s,M=d("medalFrames");return(0,r.jsxs)(i.default,{position:"relative",width:"100vw",height:"100dvh",children:[(0,r.jsx)(i.default,{position:"absolute",top:16,left:16,display:"flex",zIndex:1,onClick:c,children:Array.from({length:12}).map((e,t)=>(0,r.jsx)(i.default,{component:"img",src:t<p?(0,n.withBasePath)("/assets/tanks/PNG/Retina/tank_bullet5.png"):(0,n.withBasePath)("/assets/tanks/PNG/Retina/tank_bullet1.png"),width:64,height:64,sx:{mr:1.5,rotate:"-90deg",cursor:u}},t))}),f>0&&(0,r.jsxs)(i.default,{position:"absolute",top:56,left:16,display:"flex",alignItems:"center",zIndex:1,sx:{cursor:u},children:[(0,r.jsx)(i.default,{component:"img",src:(null==(a=M[0])||null==(t=a[0])?void 0:t.src)||(0,n.withBasePath)("/assets/medals/PNG/flat_medal1.png"),width:48,height:48,sx:{mr:2}}),(0,r.jsxs)(i.default,{component:"span",sx:{fontSize:48,color:"white",fontWeight:"bold"},children:["x",f]})]}),x>0&&(0,r.jsxs)(i.default,{position:"absolute",top:112,left:16,display:"flex",alignItems:"center",zIndex:1,sx:{cursor:u},children:[(0,r.jsx)(i.default,{component:"img",src:(0,n.withBasePath)("/assets/shooting-gallery/PNG/Objects/duck_brown.png"),width:48,height:48,sx:{mr:2}}),(0,r.jsxs)(i.default,{sx:{fontSize:48,color:"white",fontWeight:"bold"},children:["x",x]})]}),y>0&&(0,r.jsxs)(i.default,{position:"absolute",top:168,left:16,display:"flex",alignItems:"center",zIndex:1,sx:{cursor:u},children:[(0,r.jsx)(i.default,{component:"img",src:(0,n.withBasePath)(h[0]),width:48,height:48,sx:{mr:2}}),(0,r.jsxs)(i.default,{sx:{fontSize:48,color:"white",fontWeight:"bold"},children:["x",y]})]}),(0,r.jsxs)(i.default,{position:"absolute",top:16,right:16,display:"flex",alignItems:"center",zIndex:1,children:[(0,r.jsx)(i.default,{component:"img",src:(0,n.withBasePath)("/assets/shooting-gallery/PNG/HUD/text_score_small.png"),alt:"Score",sx:{mr:1}}),String(w).split("").map((e,t)=>(0,r.jsx)(i.default,{component:"img",src:(0,n.withBasePath)("".concat(m).concat(e,".png")),alt:e,width:24,height:32,sx:{mr:.5}},t))]}),(0,r.jsx)("canvas",{ref:o,onClick:l,onContextMenu:c,onTouchStart:e=>{e.preventDefault();let r=e.touches[0];l({clientX:r.clientX,clientY:r.clientY})},style:{display:"block",width:"100%",height:"100%",cursor:k}}),v&&"playing"===I&&(0,r.jsx)(i.default,{component:"img",src:(0,n.withBasePath)("/assets/shooting-gallery/PNG/HUD/text_gameover.png"),alt:"Game Over",onClick:g,sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%,-50%)",width:450,height:"auto",cursor:u}}),!v&&(0,r.jsx)(i.default,{position:"absolute",bottom:16,right:16,display:"flex",gap:1,zIndex:2,children:Object.keys(b).filter(e=>b[e].expires>C).map(e=>{let t=b[e].expires-C,a=d("powerupImgs")[e].src;return(0,r.jsx)(i.default,{component:"img",src:a,width:64,height:64,sx:{opacity:t<60&&t%10<5?.3:1}},e)})})]})},p=["/assets/tappyplane/PNG/groundDirt.png","/assets/tappyplane/PNG/groundGrass.png","/assets/tappyplane/PNG/groundIce.png","/assets/tappyplane/PNG/groundRock.png","/assets/tappyplane/PNG/groundSnow.png"],f=["/assets/shooting-gallery/PNG/Stall/tree_oak.png","/assets/shooting-gallery/PNG/Stall/tree_pine.png"],x=["/assets/shooting-gallery/PNG/Stall/water1.png","/assets/shooting-gallery/PNG/Stall/water2.png"],y=["/assets/tappyplane/PNG/rock.png","/assets/tappyplane/PNG/rockGrass.png","/assets/tappyplane/PNG/rockIce.png","/assets/tappyplane/PNG/rockSnow.png"],w=["artillery","bomb","coin2x","ducksight","freeze","ghost","homing","hourglass","infiniteAmmo","machineGuns","autoReload","megaducks","napalm","magnet","shield","supershield","shrink","skull","gunjam","sticky","heavy","spray","supermag","laserbeam","thunderstrike","windy","turbulence","blindfold","wings"],v=["skull","gunjam","sticky","heavy","windy","turbulence","blindfold"],C=["artillery","freeze","supermag","megaducks","napalm","supershield","laserbeam","thunderstrike"],b=["/assets/flame/flame_frame_1.png","/assets/flame/flame_frame_2.png","/assets/flame/flame_frame_3.png","/assets/flame/flame_frame_4.png"];var k=e.i(93010);function I(e,r,t){let a={artillery:{expires:0},bomb:{expires:0},coin2x:{expires:0},ducksight:{expires:0},freeze:{expires:0},ghost:{expires:0},gunjam:{expires:0},heavy:{expires:0},homing:{expires:0},hourglass:{expires:0},infiniteAmmo:{expires:0},machineGuns:{expires:0},autoReload:{expires:0},megaducks:{expires:0},magnet:{expires:0},napalm:{expires:0},shield:{expires:0},supershield:{expires:0},shrink:{expires:0},skull:{expires:0},spray:{expires:0},sticky:{expires:0},supermag:{expires:0},laserbeam:{expires:0},thunderstrike:{expires:0},windy:{expires:0},turbulence:{expires:0},blindfold:{expires:0},wings:{expires:0}};s.forEach(e=>{a[e].expires=1200});let n=(e,r)=>a[e].expires>0&&a[e].expires>r;return{dims:e,assets:r,audio:t,cursor:u,frameCount:0,gameOver:!1,y:.2*e.height,vy:0,groundOffset:0,score:0,ammo:12,medalCount:0,duckCount:0,enemyCount:0,dynamicDensity:.01,enemies:[],airships:[],mountains:[],trees:[],clouds:[],waters:[],shotLakes:new Set,ducks:[],powerups:[],medals:[],cannonballs:[],homingMissiles:[],artilleryShells:[],laserBeams:[],napalmMissiles:[],napalmTiles:[],laserBurstRemaining:0,laserBurstCooldown:0,burstRemaining:0,burstCooldown:0,puffs:[],sparkEffects:[],bulletHoles:[],floatingScores:[],falling:[],activePowerups:a,shieldFlash:0,screenShake:0,thunderCooldown:0,crashed:!1,crashHandled:!1,groundCrashPuffsLeft:0,planeFrame:0,planeFrameCounter:0,groundIndex:0,planeAngle:0,smokeSpawned:!1,groundContactFrames:0,whooshPlaying:!1,artilleryPlaying:!1,missileThrusterPlaying:!1,textLabels:[],streak:0,ouchFrames:0,ouchExplodeIdx:0,readyTimeout:0,goTimeout:0,beepTimeouts:[],countdown:null,countdownTimeouts:[],isActive:n,enemySpeed:e=>n("hourglass",e)?2.5:5,groundSpeed:e=>n("hourglass",e)?1:2,phase:"title"}}let M=["/assets/tanks/PNG/Retina/tank_explosion2.png","/assets/tanks/PNG/Retina/tank_explosion3.png","/assets/tanks/PNG/Retina/tank_explosion4.png"],P=["/assets/shooting-gallery/PNG/Objects/duck_brown.png","/assets/shooting-gallery/PNG/Objects/duck_white.png","/assets/shooting-gallery/PNG/Objects/duck_yellow.png"],A=["/assets/shooting-gallery/PNG/Objects/duck_outline_brown.png","/assets/shooting-gallery/PNG/Objects/duck_outline_white.png","/assets/shooting-gallery/PNG/Objects/duck_outline_yellow.png"],S=["/assets/shooting-gallery/PNG/Objects/duck_target_brown.png","/assets/shooting-gallery/PNG/Objects/duck_target_white.png","/assets/shooting-gallery/PNG/Objects/duck_target_yellow.png"],_=function(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let a=new Audio,s=!1;function o(e){if(!a)return;let t=e.split(".").pop()||"",u="mp3"===t?"audio/mpeg":"audio/".concat(t);if(""===a.canPlayType(u))return void("mp3"===t.toLowerCase()||s?console.warn("Skipping audio load, unsupported type: ".concat(u)):(s=!0,o(e.replace(/\.[^/.]+$/,".mp3"))));a.src=(0,n.withBasePath)(e),a.loop=r,a.load()}function u(){if(s)return void console.warn("Failed to load Audio (all formats):",e);"mp3"!==(e.split(".").pop()||"").toLowerCase()?(s=!0,o(e.replace(/\.[^/.]+$/,".mp3"))):console.warn("Failed to load Audio:",e)}a.addEventListener("error",u);try{o(e)}catch(r){console.warn("Failed to create/load Audio:",e,r)}return t.current=a,()=>{null==a||a.removeEventListener("error",u),a=null}},[e,r]),t},G=e=>{e&&e.current&&e.current.pause()},E=function(e,r){let t,a,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e&&e.current){if("string"==typeof r?(t=r,a=n):a=r||{},t){var s,o;let r=null!=(o=null==(s=t.split(".").pop())?void 0:s.toLowerCase())?o:"";e.current.canPlayType&&""===e.current.canPlayType("mp3"===r?"audio/mpeg":"audio/".concat(r))&&"mp3"!==r&&""!==e.current.canPlayType("audio/mpeg")&&(t=t.replace(/\.[^/.]+$/,".mp3")),e.current.src=t,e.current.load&&e.current.load()}a.loop?e.current.loop=!0:e.current.loop=!1,void 0!==a.volume?e.current.volume=a.volume:e.current.volume=1,e.current.currentTime=0,e.current.play()}};var F=e.i(83826);let R=function(){let e=(0,a.useRef)(null),r=(0,a.useRef)(null),t=function(){let e=_("/audio/whistle_fall.ogg",!0),r=_("/audio/explosionCrunch_000.ogg"),t=_("/audio/splash.ogg"),n=_("/audio/drop_003.ogg"),s=_("/audio/drop_004.ogg"),o=_("/audio/explosionCrunch_004.ogg"),u=_("/audio/laserRetro_000.ogg"),l=_("/audio/explosionCrunch_002.ogg"),i=_("/audio/select_003.ogg"),c=_("/audio/laser9.ogg"),m=_("/audio/click_001.ogg"),h=_("/audio/engineCircular_001.ogg",!0),g=_("/audio/freeze.ogg"),d=_("/audio/select_005.ogg"),p=_("/audio/explosionCrunch_002.ogg"),f=_("/audio/explosionCrunch_001.ogg"),x=_("/audio/confirmation_003.ogg"),y=_("/audio/explosionCrunch_000.ogg"),w=_("/audio/powerUp8.ogg"),v=_("/audio/scratch_003.ogg"),C=_("/audio/forceField_002.ogg"),b=_("/audio/phaserDown1.ogg"),k=_("/audio/lowDown.ogg"),I=_("/audio/laserSmall_001.ogg"),M=_("/audio/laser4.ogg"),P=_("/audio/thunderstrike.ogg"),A=_("/audio/thrusterFire_000.ogg",!0),S=_("/audio/whoosh.ogg",!0),F=(0,a.useMemo)(()=>({artillerySfx:e,artilleryExplodeSfx:r,artillerySplashSfx:t,beepSfx:n,boopSfx:s,bombSfx:o,cannonballSfx:u,crashSfx:l,duckSfx:i,enemyHitSfx:c,flapSfx:m,freezeSfx:g,flightSfx:h,gameOverSfx:d,groundTouchSfx:p,homingExplSfx:f,medalSfx:x,napalmExplodeSfx:y,powerupSfx:w,reloadSfx:v,shieldSfx:C,shrinkSfx:b,skullSfx:k,laserBeamFireSfx:I,shotSfx:M,thunderSfx:P,thrusterSfx:A,whooshSfx:S}),[e,r,t,n,s,o,u,l,i,c,m,g,h,d,p,f,x,y,w,v,C,b,k,I,M,P,A,S]),R=(0,a.useCallback)((e,r)=>{let t=F[e];t&&t.current&&E(t,r||{loop:t.current.loop,volume:t.current.volume})},[F]),T=(0,a.useCallback)(e=>{let r=F[e];r&&r.current&&G(r)},[F]),N=(0,a.useRef)({}),j=(0,a.useCallback)(()=>{Object.values(F).forEach(e=>{e.current&&G(e)});let e=N.current;(null==e?void 0:e.current)&&e.handler&&e.current.removeEventListener("ended",e.handler),N.current={}},[F]),L=(0,a.useCallback)((e,r)=>{if(!e.length)return;let t=0,a=()=>{let n=e[t];R(n,{volume:null==r?void 0:r.volume});let s=F[n],o=null==s?void 0:s.current;if(!o)return;let u=()=>{if(o.removeEventListener("ended",u),(t+=1)>=e.length)if(null==r?void 0:r.loop)t=0;else{N.current={};return}a()};N.current={current:o,handler:u},o.addEventListener("ended",u)};a()},[F,R]);return(0,a.useMemo)(()=>({play:R,playSequence:L,pause:T,pauseAll:j}),[R,L,T,j])}(),{play:i,pause:c}=t,d=function(){let[e,r]=(0,a.useState)(!1),t=(0,a.useRef)({});return(0,a.useEffect)(()=>{let e=e=>{let r=new window.Image;return r.src=(0,n.withBasePath)(e),r};t.current.airshipFrames=Object.fromEntries(g.map(r=>[r,[1,2,3].map(t=>e("/assets/airships/airship_".concat(r,"_").concat(t,".png")))])),t.current.artilleryImg=e("/assets/tanks/PNG/Retina/tank_bulletFly6.png"),t.current.blackSmokeImgs=Array.from({length:25},(r,t)=>e("/assets/smoke/PNG/Black smoke/blackSmoke".concat(String(t).padStart(2,"0"),".png"))),t.current.brokenStickImg=e("/assets/shooting-gallery/PNG/Objects/stick_wood_broken.png"),t.current.bulletHoleImg=e("/assets/shooting-gallery/PNG/Objects/shot_brown_large.png"),t.current.cannonballImg=e("/assets/pirates/PNG/Retina/Ship parts/cannonBall.png"),t.current.digitImgs={};for(let r=0;r<=9;r++)t.current.digitImgs[r.toString()]=e("".concat(m).concat(r,".png"));t.current.duckImgs=P.map(e),t.current.duckOutlineImgs=A.map(e),t.current.duckTargetImgs=S.map(e),t.current.enemyImgs=h.map(e),t.current.enemyFrames=h.map(r=>[1,2,3].map(t=>e(r.replace(/1\.png$/,"".concat(t,".png"))))),t.current.explosionImgs=M.map(e),t.current.fireImgs=[e("/assets/pirates/PNG/Retina/Effects/fire1.png"),e("/assets/pirates/PNG/Retina/Effects/fire2.png")],t.current.flameImgs=b.map(e),t.current.groundImgs=p.map(e),t.current.homingImg=e("/assets/tanks/PNG/Retina/tank_bullet3.png"),t.current.letterImgs={};for(let r=65;r<=90;r++){let a=String.fromCharCode(r);t.current.letterImgs[a]=e("/assets/tappyplane/PNG/Letters/letter".concat(a,".png"))}t.current.medalFrames=[];for(let r=1;r<=9;r++)t.current.medalFrames.push([e("/assets/medals/PNG/flat_medal".concat(r,".png")),e("/assets/medals/PNG/flatshadow_medal".concat(r,".png")),e("/assets/medals/PNG/shaded_medal".concat(r,".png"))]);t.current.napalmImg=e("/assets/tanks/PNG/Retina/tank_bullet4.png"),t.current.numberImgs={};for(let r=0;r<=9;r++)t.current.numberImgs[r.toString()]=e("/assets/tappyplane/PNG/Numbers/number".concat(r,".png"));t.current.planeFrames=[1,2,3].map(r=>e("/assets/tappyplane/PNG/Planes/planeYellow".concat(r,".png"))),t.current.planeImg=t.current.planeFrames[0],t.current.plusImg=e("/assets/shooting-gallery/PNG/HUD/text_plus_small.png"),t.current.powerupImgs=Object.fromEntries(w.map(r=>[r,e("/assets/powerups/".concat(r,".png"))])),t.current.powerupImgs||(t.current.powerupImgs={}),t.current.powerupImgs.coin2x=e("/assets/powerups/coin_2x.png"),t.current.powerupImgs.infiniteAmmo=e("/assets/powerups/infinite_ammo.png"),t.current.powerupImgs.machineGuns=e("/assets/powerups/machine_guns.png"),t.current.powerupImgs.autoReload=e("/assets/powerups/autoReload.png"),t.current.powerupImgs.shrink=e("/assets/powerups/shrink_effect.png"),t.current.puffLargeImg=e("/assets/tappyplane/PNG/puffLarge.png"),t.current.puffSmallImg=e("/assets/tappyplane/PNG/puffSmall.png"),t.current.rockImgs=y.map(e),t.current.shieldImg=e("/assets/particles/PNG (Transparent)/circle_03.png"),t.current.sparkImgs=Array.from({length:7},(r,t)=>e("/assets/particles/PNG (Transparent)/spark_0".concat(t+1,".png"))),t.current.laserBeamImgs=[e("/assets/space-shooter-redux/PNG/Lasers/laserRed04.png"),e("/assets/space-shooter-redux/PNG/Lasers/laserRed04.png")],t.current.stickImg=e("/assets/shooting-gallery/PNG/Objects/stick_wood.png"),t.current.targetImgs=[e("/assets/shooting-gallery/PNG/Objects/target_red1.png"),e("/assets/shooting-gallery/PNG/Objects/target_red2.png"),e("/assets/shooting-gallery/PNG/Objects/target_red3.png")],t.current.treeImgs=f.map(e),t.current.waterImgs=x.map(e),t.current.whitePuffImgs=Array.from({length:25},(r,t)=>e("/assets/smoke/PNG/White puff/whitePuff".concat(String(t).padStart(2,"0"),".png"))),r(!0)},[]),{get:(0,a.useCallback)(e=>t.current[e],[]),getImg:(0,a.useCallback)(e=>{var r;return null!=(r=t.current[e])?r:void 0},[]),assetRefs:t.current,ready:e}}(),{getImg:R,ready:T}=d,N=(0,k.useWindowSize)(),j=N.width>0&&N.height>0?N:{width:window.innerWidth,height:window.innerHeight},L=(0,a.useRef)(I(j,d,t)),O=(0,a.useRef)(!1),[B,z]=(0,a.useState)({...L.current}),D=(0,a.useCallback)(()=>{let e=L.current;(B.score!==e.score||B.medalCount!==e.medalCount||B.duckCount!==e.duckCount||B.enemyCount!==e.enemyCount||B.ammo!==e.ammo||B.crashed!==e.crashed||B.frameCount!==e.frameCount||JSON.stringify(B.activePowerups)!==JSON.stringify(e.activePowerups)||B.cursor!==e.cursor||B.countdown!==e.countdown||B.phase!==e.phase)&&z({score:e.score,medalCount:e.medalCount,duckCount:e.duckCount,enemyCount:e.enemyCount,ammo:e.ammo,crashed:e.crashed,activePowerups:Object.fromEntries(Object.entries(e.activePowerups).map(e=>{let[r,t]=e;return[r,{expires:t.expires}]})),frameCount:e.frameCount,cursor:e.cursor,countdown:e.countdown,phase:e.phase})},[B.score,B.medalCount,B.duckCount,B.enemyCount,B.ammo,B.crashed,B.frameCount,B.activePowerups,B.cursor,B.countdown,B.phase]),H=(0,a.useCallback)(e=>{let r=L.current.isActive("coin2x",L.current.frameCount)&&e>0;L.current.score+=Math.max(r?2*e:e,0)},[L]),Y=(0,a.useCallback)(()=>{L.current={...I(N,d,t),groundIndex:Math.floor(Math.random()*R("groundImgs").length)}},[N,d,t,R]),U=(0,a.useCallback)((e,r,t,a,n,s,o)=>{let u=(0,F.newTextLabel)({text:e,scale:r,fixed:t,fade:a,x:n,y:s,vy:-.5,maxAge:o},d,N);L.current.textLabels.push(u)},[d,N]),W=(0,a.useCallback)((e,r,t)=>{let a=6+Math.floor(4*Math.random());for(let n=0;n<a;n++){let a=Math.random()*Math.PI*2,n=Math.sqrt(Math.random()),s=Math.cos(a)*n*200,o=Math.sin(a)*n*100;L.current.napalmTiles.push({x:e+s,y:r+o,vy:0,life:600,maxLife:600,killsPlayer:t})}i("napalmExplodeSfx")},[i]),X=(0,a.useCallback)((e,r)=>{let t=R("blackSmokeImgs"),a=t[Math.floor(Math.random()*t.length)];L.current.puffs.push({x:e-16,y:r-16,vy:-(+Math.random()+.5),img:a,age:0,maxAge:60})},[R]),$=(0,a.useCallback)((e,r)=>(function(e,r,t,a){let n=3+Math.floor(3*Math.random()),s=50+.1*r*Math.random(),o=[];for(let e=0;e<n;e++){let e=t[Math.floor(Math.random()*t.length)],r=(Math.random()-.5)*200,a=(Math.random()-.5)*50,n=1+.5*Math.random();o.push({img:e,dx:r,dy:a,scale:n})}return{x:e+100,y:s,vx:-1*a()*.3,puffs:o}})(e,r,R("whitePuffImgs"),()=>L.current.groundSpeed(L.current.frameCount)),[R,L]),q=(0,a.useCallback)((e,r)=>(function(e,r,t,a,n,s){let o=e+300*Math.random(),u=200+100*Math.random();return Array.from({length:3+Math.floor(3*Math.random())}).map((n,s)=>{let l=function(e,r,t,a,n,s){let o=t[Math.floor(Math.random()*t.length)],u=1+Math.random()*(2-n),l=u*(.8+.4*Math.random())*3,i=2*u,c=o.width*l,m=o.height*i;return{x:e+200*Math.random(),y:r-50-m,vx:-1*a()*.2,img:o,width:c,height:m,scaleX:l,scaleY:i}}(e,r,t,a,1,2);return l.x=o+s*u*(.8+.4*Math.random()),l})})(e,r,R("rockImgs"),()=>L.current.groundSpeed(L.current.frameCount),0,0),[R,L]),J=(0,a.useCallback)((e,r,t)=>(function(e,r,t,a,n){let s=t[Math.floor(Math.random()*t.length)],o=null!=n?n:.5+Math.random(),u=s.width*o,l=s.height*o;return{x:e+200*Math.random(),y:r-50-l+40,vx:-1*a()*.2,img:s,width:u,height:l,scaleX:o,scaleY:o}})(e,r,R("treeImgs"),()=>L.current.groundSpeed(L.current.frameCount),t),[R,L]),K=(0,a.useCallback)((e,r)=>{i("shotSfx");let t=R("powerupImgs"),a=-8;L.current.isActive("heavy",L.current.frameCount)&&(a*=.5),L.current.isActive("sticky",L.current.frameCount)&&(a=0),L.current.isActive("wings",L.current.frameCount)&&(a*=2),L.current.y;let n=!1;for(let a=0;a<L.current.airships.length;a++){let s=L.current.airships[a],o=80*Math.sin(.05*L.current.frameCount+s.bobOffset),u=s.baseY+o;if(e>=s.x&&e<=s.x+164&&r>=u&&r<=u+164){if(n=!0,L.current.airships.splice(a,1),"green"===s.color){let e=C[Math.floor(Math.random()*C.length)];L.current.powerups.push({x:s.x,y:u,img:t[e],type:e})}else{W(s.x+82,u+82,!0);let e=v[Math.floor(Math.random()*v.length)];L.current.powerups.push({x:s.x,y:u,img:t[e],type:e})}break}}for(let t=0;t<L.current.ducks.length;t++){let a=L.current.ducks[t],s=L.current.isActive("megaducks",L.current.frameCount)?3:L.current.isActive("ducksight",L.current.frameCount)?1.33:1,o=a.width*s,u=a.height*s,l=(o-a.width)/2,c=(u-a.height)/2,m=a.x-l,h=a.y-c;if(!a.hit&&e>=m&&e<=m+o&&r>=h&&r<=h+u){i("duckSfx"),H(1e3),a.hit=!0,a.fadeAge=0,a.fadeMax=60,a.targetImg=R("duckTargetImgs")[a.srcIdx],L.current.floatingScores.push({x:a.x+a.width/2,y:a.y+a.height/2,vy:-1,amount:1e3,age:0,maxAge:60}),L.current.shotLakes.add(a.waterRef),L.current.duckCount+=1,n=!0;break}}for(let t=0;t<L.current.powerups.length;t++){let a=L.current.powerups[t];if(!a.collected&&e>=a.x&&e<=a.x+128&&r>=a.y&&r<=a.y+128){a.collected=!0,["bomb"].includes(a.type)?(i("bombSfx"),L.current.activePowerups.bomb.expires=L.current.frameCount+1):v.includes(a.type)?["sticky","heavy","windy","turbulence","blindfold"].includes(a.type)?(L.current.activePowerups[a.type].expires=L.current.frameCount+1200,"turbulence"===a.type?U("Turbulence!",1,!0,!0,N.width-800,.8*N.height,120):"blindfold"===a.type&&U("Blinded!",1,!0,!0,N.width-800,.8*N.height,120)):L.current.activePowerups[a.type].expires=L.current.frameCount+30:"machineGuns"===a.type?(L.current.activePowerups.machineGuns.expires=L.current.frameCount+1200,L.current.burstRemaining=5,L.current.burstCooldown=0):"autoReload"===a.type?(L.current.activePowerups.autoReload.expires=L.current.frameCount+1200,i("powerupSfx")):"shrink"===a.type?(L.current.activePowerups.shrink.expires=L.current.frameCount+1200,i("shrinkSfx")):"freeze"===a.type?(L.current.activePowerups.freeze.expires=L.current.frameCount+1200,i("freezeSfx")):(L.current.activePowerups[a.type].expires=L.current.frameCount+1200,i("powerupSfx")),"skull"===a.type?(i("skullSfx"),Object.keys(L.current.activePowerups).forEach(e=>{"skull"!==e&&(L.current.activePowerups[e].expires=0)}),H(-500),U("Skull! Lose 500",1,!0,!0,N.width-800,.8*N.height,120)):"gunjam"===a.type&&(L.current.activePowerups.gunjam.expires=L.current.frameCount+1200,H(-25),i("reloadSfx"),U("Gunjam Lose 25",1,!0,!0,N.width-800,.8*N.height,120),L.current.ammo=0),n=!0,L.current.powerups.splice(t,1);break}}for(let t=0;t<L.current.medals.length;t++){let a=L.current.medals[t];if(e>=a.x&&e<=a.x+64&&r>=a.y&&r<=a.y+64){i("medalSfx"),H(500),L.current.floatingScores.push({x:a.x+32,y:a.y+32,vy:-1,amount:500,age:0,maxAge:60}),L.current.medals.splice(t,1),L.current.medalCount+=1,n=!0;break}}let o=R("targetImgs")[0],u=o.width,l=o.height;for(let a of L.current.enemies){let o=a.hasStick?0:101.25-l;if(a.alive&&a.hasStick&&!a.stickBroken&&e>=a.x+67.5-u/2&&e<=a.x+67.5+u/2&&r>=a.y+o&&r<=a.y+o+l&&(n=!0,a.stickBroken=!0,a.targetHit=!0,i("enemyHitSfx"),H(a.targetScore),L.current.floatingScores.push({x:a.x+67.5,y:a.y+o+l/2,vy:-1,amount:a.targetScore,age:0,maxAge:60})),!n&&a.alive&&e>=a.x&&e<=a.x+135&&r>=a.y&&r<=a.y+101.25){n=!0,a.alive=!1,i("enemyHitSfx"),H(100);let e=a.x+67.5,r=a.y+50.625;if(L.current.enemyCount+=1,.3>Math.random()){let t=Math.floor(9*Math.random()),a=R("medalFrames")[t];L.current.medals.push({x:e-32,y:r-32,vx:-L.current.groundSpeed(L.current.frameCount),frames:a,frameIndex:0,frameCounter:0,frameRate:8,id:t+1})}else if(.5>Math.random()){let a=s.length>0?s[Math.floor(Math.random()*s.length)]:w[Math.floor(Math.random()*w.length)];0===s.length&&!v.includes(a)&&.5>Math.random()&&(a=v[Math.floor(Math.random()*v.length)]),L.current.powerups.push({x:e-16,y:r-16,img:t[a],type:a})}L.current.floatingScores.push({x:e,y:r,vy:-1,amount:100,age:0,maxAge:60});let o=R("explosionImgs"),u=Math.floor(3*Math.random());if(0===u)for(let t=0;t<5;t++)setTimeout(()=>X(e,r),100*t);else 1===u?o.forEach((t,a)=>setTimeout(()=>L.current.puffs.push({x:e-16,y:r-16,img:t,vy:0,age:0,maxAge:10,size:96}),50*a)):(L.current.puffs.push({x:e-48,y:r-48,img:o[0],vy:0,age:0,maxAge:10,size:96}),L.current.falling.push({x:a.x,y:a.y,vy:0,img:a.frames[0]}));break}}n||(H(-25),L.current.streak=0,L.current.bulletHoles.push({x:e,y:r,age:0,maxAge:180})),(n||0)&&(L.current.streak+=1,L.current.streak>=3&&U("Streak: ".concat(L.current.streak),1,!0,!0,N.width-800,88,120))},[i,R,L,H,W,U,N.width,N.height,X]),V=(0,a.useCallback)(e=>!!B.activePowerups[e]&&B.activePowerups[e].expires>B.frameCount,[B.activePowerups,B.frameCount]),Q=(0,a.useCallback)(()=>{r.current&&cancelAnimationFrame(r.current),L.current.countdownTimeouts.forEach(clearTimeout),L.current.countdownTimeouts=[];let e=N.width>0&&N.height>0?N:{width:window.innerWidth,height:window.innerHeight},a=(0,F.newTextLabel)({text:"READY",scale:4,fixed:!0,fade:!1,y:.3*e.height,maxAge:180},d,e);L.current.textLabels.push(a);let n=r=>{let t=(0,F.newTextLabel)({text:"".concat(r),scale:3,fixed:!0,fade:!0,y:.55*e.height,maxAge:60},d,e);L.current.textLabels.push(t)},s="ready";L.current.phase=s,L.current.countdown=3,z(e=>({...e,countdown:3,phase:s})),n(3),L.current.countdownTimeouts.push(window.setTimeout(()=>{L.current.countdown=2,z(e=>({...e,countdown:2})),n(2)},1e3),window.setTimeout(()=>{L.current.countdown=1,z(e=>({...e,countdown:1})),n(1)},2e3),window.setTimeout(()=>{L.current.countdown=null,z(e=>({...e,countdown:null}))},3e3),window.setTimeout(()=>{let r=(0,F.newTextLabel)({text:"GO",scale:4,fixed:!0,fade:!0,y:.4*e.height,maxAge:60},d,e);L.current.textLabels.push(r),L.current.phase="go",z(e=>({...e,phase:"go"}))},3e3),window.setTimeout(()=>{let r="playing";L.current={...I(e,d,t),groundIndex:Math.floor(Math.random()*R("groundImgs").length),countdown:null,countdownTimeouts:[],phase:r},z(e=>({...e,phase:r}))},3500)),i("flightSfx")},[N,d,t,R,i]),Z=(0,a.useCallback)(()=>{if(console.log("Game initLoop"),O.current)return void console.log("initLoop called, but loop already runningâ€”skipping.");O.current=!0;let t=R("waterImgs");r.current&&cancelAnimationFrame(r.current);let a=e.current;if(!a)return;let n=a.getContext("2d");if(!n)return;let{width:s,height:l}=N,m=window.devicePixelRatio||1;a.width=s*m,a.height=l*m,a.style.width="".concat(s,"px"),a.style.height="".concat(l,"px"),n.scale(m,m),Y(),L.current.phase="playing",i("flightSfx");let h=l-50,d=R("groundImgs"),p=d[0].width,f=!1,x=u,y=()=>{L.current.isActive("blindfold",L.current.frameCount)?(f||(x=L.current.cursor,f=!0),L.current.cursor="none"):f&&(L.current.cursor=x,f=!1);let e=L.current.isActive("shrink",L.current.frameCount)?.4:1,a=L.current.isActive("freeze",L.current.frameCount)?0:L.current.isActive("hourglass",L.current.frameCount)?.15:.3,u=L.current.isActive("wings",L.current.frameCount)?-16:-8;if(L.current.isActive("thunderstrike",L.current.frameCount)&&(L.current.thunderCooldown-=1,L.current.thunderCooldown<=0)){L.current.thunderCooldown=180;let e=[...L.current.enemies.filter(e=>e.alive)];if(e.length>0){let r=235,t=L.current.y+50.625;e.sort((e,a)=>Math.hypot(r-e.x,t-e.y)-Math.hypot(r-a.x,t-a.y));let a=[],n=e[0];a.push(n);let s=n.x,o=n.y;for(let r=1;r<e.length&&a.length<3;r++)300>Math.hypot(s-e[r].x,o-e[r].y)&&a.push(e[r]);a.forEach((e,r)=>{if("alive"in e&&(e.alive=!1),"hit"in e&&(e.hit=!0),L.current.floatingScores.push({x:e.x,y:e.y,vy:-1,amount:200,age:0,maxAge:60}),H(200),L.current.enemyCount+=1,L.current.sparkEffects.push({x:e.x,y:e.y-50,age:0,maxAge:60,frameIndex:0}),r>0){let r=a[0];L.current.sparkEffects.push({x:(r.x+e.x)/2,y:(r.y+e.y)/2-30,age:0,maxAge:20,frameIndex:0})}}),i("thunderSfx")}}if(L.current.isActive("homing",L.current.frameCount)&&.01>Math.random()){let e=L.current.enemies[0];L.current.homingMissiles.push({x:235,y:L.current.y+50.625,vx:0,vy:0,img:R("homingImg"),tailFrame:0,tailCounter:0,life:120,target:e})}if(L.current.isActive("artillery",L.current.frameCount)&&.02>Math.random()){let e=Math.random()*(s-200)+200,r=Math.PI/2+Math.PI/3*(Math.random()-.5),t=8+4*Math.random();L.current.artilleryShells.push({x:e,y:-32,vx:Math.cos(r)*t,vy:Math.sin(r)*t,img:R("artilleryImg")})}if(L.current.isActive("napalm",L.current.frameCount)&&.005>Math.random()){let e=.1+.19999999999999998*Math.random();L.current.napalmMissiles.push({x:-32,y:l*e,vx:4,life:Math.ceil((s+64)/4),dropsRemaining:6+Math.floor(4*Math.random()),dropTimer:20,img:R("napalmImg"),tailFrame:0,tailCounter:0,explodeX:400+600*Math.random()})}if(L.current.isActive("laserbeam",L.current.frameCount)&&(0===L.current.laserBurstRemaining&&.01>Math.random()&&(L.current.laserBurstRemaining=15,L.current.laserBurstCooldown=0),L.current.laserBurstRemaining>0&&(0===L.current.laserBurstCooldown?(L.current.laserBeams.push({x:235,y:L.current.y+50.625,frame:0,frameCounter:0}),i("laserBeamFireSfx"),L.current.laserBurstRemaining--,L.current.laserBurstCooldown=2):L.current.laserBurstCooldown--)),L.current.isActive("machineGuns",L.current.frameCount)&&(0===L.current.burstRemaining&&.01>Math.random()&&(L.current.burstRemaining=5,L.current.burstCooldown=0),L.current.burstRemaining>0))if(0===L.current.burstCooldown){let e=L.current.y+50.625;L.current.cannonballs.push({x:235,y:e,vx:12,img:R("cannonballImg")}),i("cannonballSfx"),L.current.burstRemaining--,L.current.burstCooldown=5}else L.current.burstCooldown--;L.current.isActive("autoReload",L.current.frameCount)&&L.current.ammo<12&&L.current.frameCount%15==0&&(L.current.ammo=Math.min(12,L.current.ammo+1),i("reloadSfx"));let m=R("planeFrames");L.current.planeFrameCounter++,L.current.planeFrameCounter>=6&&(L.current.planeFrameCounter=0,L.current.planeFrame=(L.current.planeFrame+1)%m.length),L.current.frameCount++;let w=R("enemyFrames");if(Math.random()<L.current.dynamicDensity){let e=Math.floor(Math.random()*w.length),r=.25>Math.random(),t=-1,a=-1;r&&(a=[500,250,100][t=Math.floor(3*Math.random())]),L.current.enemies.push({x:s+135,y:50+Math.random()*(l-200),vy:0,flapStrength:-(8+4*Math.random()),frames:w[e],propFrame:Math.floor(3*Math.random()),frameRate:6,frameCounter:0,alive:!0,glide:!0,loopProgress:-1,baseY:50+Math.random()*(l-200),rotation:0,stepProgress:-1,stepDelta:0,hasStick:r,stickBroken:!1,stickImg:R("stickImg"),brokenStickImg:R("brokenStickImg"),targetImg:r?R("targetImgs")[t]:void 0,targetType:r?"red".concat(t+1):void 0,targetScore:r?a:0,targetFadeAge:0,targetFadeMax:60*!!r,targetHit:!1,targetVy:0})}if(n.fillStyle=o,n.fillRect(0,0,s,l),.001>Math.random()){let e=q(s,l),r=Math.min(...e.map(e=>e.x)),t=Math.max(...e.map(e=>e.x+e.width));L.current.mountains.some(e=>{let a=e.x;return r<e.x+e.width&&a<t})||L.current.mountains.push(...e)}if(L.current.mountains.forEach((e,r)=>{e.x+=e.vx,n.globalAlpha=.8,n.drawImage(e.img,e.x,e.y+40,e.width,e.height),n.globalAlpha=1,e.x+s<0&&L.current.mountains.splice(r,1)}),.005>Math.random()&&L.current.trees.push(J(s,l)),L.current.trees.forEach((e,r)=>{e.x+=e.vx,n.globalAlpha=.9,n.drawImage(e.img,e.x,e.y,e.width,e.height),n.globalAlpha=1,e.x+e.width+s<0&&L.current.trees.splice(r,1)}),.0015>Math.random()&&(L.current.clouds.some(e=>e.x>s)||L.current.clouds.push($(s,l))),L.current.clouds.forEach((e,r)=>{e.x+=e.vx,e.puffs.forEach(r=>{let{img:t,dx:a,dy:s,scale:o}=r,u=t.width*o,l=t.height*o;n.globalAlpha=.8,n.drawImage(t,e.x+a,e.y+s,u,l)}),n.globalAlpha=1,e.x+1.5*s<0&&L.current.clouds.splice(r,1)}),5e-4>Math.random()){let e=g[Math.floor(Math.random()*g.length)],r=l*(.1+.1*Math.random()),t=1+2*Math.random();L.current.airships.push({x:-492,baseY:r,frames:R("airshipFrames")[e],frameIndex:Math.floor(3*Math.random()),frameCounter:0,frameRate:10,speed:t,color:e,bobOffset:Math.random()*Math.PI*2})}L.current.airships=L.current.airships.filter(e=>{e.x+=e.speed;let r=80*Math.sin(.05*L.current.frameCount+e.bobOffset),t=e.baseY+r;e.frameCounter++,e.frameCounter>=e.frameRate&&(e.frameCounter=0,e.frameIndex=(e.frameIndex+1)%e.frames.length);let a=e.frames[e.frameIndex];return n.drawImage(a,e.x,t,164,164),e.x<=s+a.width}),!(L.current.airships.length>0)||L.current.whooshPlaying||L.current.crashed?0===L.current.airships.length&&L.current.whooshPlaying&&(c("whooshSfx"),L.current.whooshPlaying=!1):(i("whooshSfx"),L.current.whooshPlaying=!0),L.current.crashed&&L.current.whooshPlaying&&(c("whooshSfx"),L.current.whooshPlaying=!1),L.current.textLabels=(0,F.drawTextLabels)({textLabels:L.current.textLabels,ctx:n,offsetX:L.current.groundOffset,cull:!0}),L.current.bulletHoles.forEach(e=>{n.globalAlpha=1-e.age/e.maxAge,n.drawImage(R("bulletHoleImg"),e.x-16,e.y-16,32,32),e.age++}),L.current.bulletHoles=L.current.bulletHoles.filter(e=>e.age<e.maxAge),n.globalAlpha=1;let C=L.current.isActive("freeze",L.current.frameCount);L.current.enemies.forEach(r=>{let t=r.x+67.5,s=r.y+50.625,o=135*e,u=101.25*e;if(!r.alive)return;if(C||r.glide){if(!C){if(r.loopProgress<0&&.001>Math.random()&&(r.loopProgress=0,r.baseY=r.y),r.loopProgress>=0){let e=r.loopProgress/180*Math.PI*2;r.y=r.baseY+100*Math.sin(e),r.rotation=e,r.loopProgress++,r.loopProgress>180&&(r.loopProgress=-1,r.rotation=0,r.y=r.baseY)}if(r.loopProgress<0){if(r.stepProgress<0&&.005>Math.random()){r.stepProgress=0;let e=h-101.25-50,t=50-r.baseY,a=e-r.baseY;r.stepDelta=Math.min(t+Math.random()*(a-t),150)}if(r.stepProgress>=0){let e=r.stepProgress/60;r.y=r.baseY+r.stepDelta*e;let t=r.stepDelta/60;r.rotation=-1*Math.atan2(t,L.current.enemySpeed(L.current.frameCount)),r.stepProgress++,r.stepProgress>60&&(r.baseY+=r.stepDelta,r.y=r.baseY,r.stepProgress=-1,r.rotation=0)}else r.rotation=0;if(r.stepProgress>=0){let e=r.stepProgress/60;r.y=r.baseY+r.stepDelta*e,r.stepProgress++,r.stepProgress>60&&(r.baseY+=r.stepDelta,r.y=r.baseY,r.stepProgress=-1)}}}}else L.current.frameCount%60==0&&(r.vy=r.flapStrength),r.vy+=a,r.y+=r.vy,r.y+101.25>=h&&(r.y=h-101.25,r.vy=r.flapStrength);if(!C&&L.current.isActive("windy",L.current.frameCount)&&(r.x+=(2*Math.random()-1)*8,r.y+=(2*Math.random()-1)*8,r.flapStrength=-(8+4*Math.random())),!C){let e=Math.cos(r.rotation||0);r.x-=L.current.enemySpeed(L.current.frameCount)*e}r.frameCounter++,r.frameCounter>=r.frameRate&&(r.frameCounter=0,r.propFrame=(r.propFrame+1)%r.frames.length);let l=r.frames[r.propFrame];if(n.save(),n.translate(t,s),r.rotation&&n.rotate(r.rotation),n.scale(-1,1),n.drawImage(l,-o/2,-u/2,o,u),n.restore(),r.hasStick){n.save(),n.translate(t,s),r.rotation&&n.rotate(r.rotation),n.scale(-1,1);let e=.5*r.stickImg.width,a=.5*r.stickImg.height;if(n.save(),n.rotate(Math.PI),n.drawImage(r.stickBroken?r.brokenStickImg:r.stickImg,-e/2,-a,e,a),n.restore(),!r.targetHit){let e=.5*r.targetImg.width,t=.5*r.targetImg.height;n.drawImage(r.targetImg,-e/2,-a+120,e,t)}n.restore()}.02>Math.random()&&X(t,s),r.x+135<0&&(r.alive=!1)}),L.current.enemies=L.current.enemies.filter(e=>e.alive);let b=()=>{L.current.vy=u,L.current.planeAngle=-.5;let e=167.5,r=L.current.y+50.625;L.current.puffs.push({x:e-16,y:r-16,img:R("puffLargeImg"),vy:0,age:0,maxAge:20}),setTimeout(()=>L.current.puffs.push({x:e-16,y:r-16,img:R("puffSmallImg"),vy:0,age:0,maxAge:15}),100)};!L.current.crashed&&.025>Math.random()&&L.current.y>0&&b(),L.current.crashed||(L.current.vy+=a,L.current.y+=L.current.vy,L.current.isActive("turbulence",L.current.frameCount)&&(L.current.vy+=(2*Math.random()-1)*.5,L.current.y+=(2*Math.random()-1)*8,L.current.planeAngle+=(2*Math.random()-1)*.2),L.current.y+101.25>=h&&b(),L.current.isActive("ghost",L.current.frameCount)||L.current.crashed||L.current.enemies.forEach(e=>{let r=167.5,t=L.current.y+50.625;if(e.x<r+67.5&&e.x+135>r-67.5&&e.y<t+50.625&&e.y+101.25>t-50.625){L.current.crashed=!0,L.current.groundContactFrames=0,e.alive=!1;let r=R("explosionImgs"),t=r[Math.floor(Math.random()*r.length)];L.current.falling.push({x:e.x,y:e.y,vy:0,img:t});let a=r[Math.floor(Math.random()*r.length)];L.current.falling.push({x:100,y:L.current.y,vy:0,img:a})}}),L.current.crashed&&!L.current.isActive("ghost",L.current.frameCount)&&(L.current.isActive("shield",L.current.frameCount)||L.current.isActive("supershield",L.current.frameCount)?(L.current.isActive("shield",L.current.frameCount)&&(L.current.activePowerups.shield.expires=0),L.current.shieldFlash=10,L.current.crashed=!1,i("shieldSfx")):(L.current.crashed=!0,Object.keys(L.current.activePowerups).forEach(e=>{L.current.activePowerups[e].expires=0}),i("crashSfx"),c("flightSfx"))));let k=L.current.y,I={x:167.5,y:L.current.y+50.625};for(let e=L.current.medals.length-1;e>=0;e--){let r=L.current.medals[e];r.x<235&&r.x+64>100&&r.y<k+101.25&&r.y+64>k&&(i("medalSfx"),H(500),L.current.floatingScores.push({x:r.x+32,y:r.y+32,vy:-1,amount:500,age:0,maxAge:60}),L.current.medals.splice(e,1),L.current.medalCount++)}L.current.medals.forEach((e,r)=>{e.frameCounter++,e.frameCounter>=e.frameRate&&(e.frameCounter=0,e.frameIndex=(e.frameIndex+1)%e.frames.length),e.x+=e.vx,(L.current.isActive("magnet",L.current.frameCount)||L.current.isActive("supermag",L.current.frameCount))&&500>Math.hypot(I.x-(e.x+32),I.y-(e.y+32))&&(e.x+=(100-e.x)*.05,e.y+=(L.current.y-e.y)*.05);let t=e.frames[e.frameIndex];n.drawImage(t,e.x,e.y,64,64),e.x+64<0&&L.current.medals.splice(r,1)}),L.current.powerups.forEach((e,r)=>{!e.collected&&(e.x-=L.current.groundSpeed(L.current.frameCount),n.drawImage(e.img,e.x,e.y,128,128),e.x+128<0&&L.current.powerups.splice(r,1))}),L.current.isActive("supermag",L.current.frameCount)&&(L.current.ducks=L.current.ducks.filter(e=>{let r=I.x-(e.x+e.width/2),t=I.y-(e.y+e.height/2);500>Math.hypot(r,t)&&(e.x+=.1*r,e.y+=.1*t);let a=L.current.isActive("megaducks",L.current.frameCount)?2.5:1,n=e.width*a,s=e.height*a,o=(n-e.width)/2,u=(s-e.height)/2,l=e.x-o,i=e.y-u;return!(I.x>l)||!(I.x<l+n)||!(I.y>i)||!(I.y<i+s)||(H(1e3),L.current.floatingScores.push({x:e.x+e.width/2,y:e.y+e.height/2,vy:-1,amount:1e3,age:0,maxAge:60}),L.current.duckCount++,!1)}),L.current.powerups=L.current.powerups.filter(e=>{if(v.includes(e.type))return!0;let r=I.x-(e.x+32),t=I.y-(e.y+32);return 500>Math.hypot(r,t)&&(e.x+=.1*r,e.y+=.1*t),!(I.x>e.x)||!(I.x<e.x+64)||!(I.y>e.y)||!(I.y<e.y+64)||(L.current.activePowerups[e.type].expires=L.current.frameCount+1200,i("powerupSfx"),L.current.floatingScores.push({x:e.x+32,y:e.y+32,vy:-1,amount:25,age:0,maxAge:60}),!1)})),L.current.groundOffset=(L.current.groundOffset+L.current.groundSpeed(L.current.frameCount))%p;let M=R("explosionImgs");!L.current.crashed&&L.current.y+101.25>=h?(L.current.groundContactFrames++,L.current.groundContactFrames>=180&&(L.current.groundContactFrames=0,i("groundTouchSfx"),H(-100),U("SHOOT PLANE TO FLY",1.5,!0,!0,100,N.height/2,60),U("OUCH",.5,!0,!0,147.5,L.current.y-30,30),L.current.ouchExplodeIdx=Math.floor(Math.random()*M.length),L.current.ouchFrames=30)):L.current.groundContactFrames=0;for(let e=-L.current.groundOffset;e<s;e+=p)n.drawImage(d[L.current.groundIndex],e,h,p,50);if(!L.current.crashed){if(L.current.ouchFrames>0){let e=M[L.current.ouchExplodeIdx],r=L.current.y;n.drawImage(e,167.5-e.width/2,r-e.height,67.5,50.625)}let e=0,r=0;L.current.ouchFrames>0&&(e=(Math.random()-.5)*10,r=(Math.random()-.5)*6,L.current.ouchFrames--),L.current.planeFrameCounter++,L.current.planeFrameCounter>=6&&(L.current.planeFrameCounter=0,L.current.planeFrame=(L.current.planeFrame+1)%m.length);let t=m[L.current.planeFrame],a=167.5+e,s=L.current.y+50.625+r+10;if(n.save(),n.translate(a,s),L.current.isActive("shield",L.current.frameCount)||L.current.isActive("supershield",L.current.frameCount)||L.current.shieldFlash>0){L.current.shieldFlash>0&&(n.globalAlpha=L.current.shieldFlash%2==0?.2:.6);let e=236.25;n.drawImage(R("shieldImg"),-e/2,-e/2,e,e),L.current.shieldFlash>0&&(n.globalAlpha=1,L.current.shieldFlash--)}n.rotate(L.current.planeAngle),L.current.isActive("ghost",L.current.frameCount)&&(n.globalAlpha=.4),n.drawImage(t,-67.5,-50.625,135,101.25),n.globalAlpha=1,n.restore(),L.current.planeAngle=Math.min(0,L.current.planeAngle+.02),L.current.ouchFrames--}L.current.artilleryShells=L.current.artilleryShells.filter(e=>{e.x+=e.vx,e.y+=e.vy;let r=Math.atan2(e.vy,e.vx),a=e.img,s=32/a.naturalHeight,o=a.naturalWidth*s,u=.8*o;n.save(),n.translate(e.x,e.y),n.rotate(r),n.drawImage(a,-u,-16,o,32),n.restore();let c=!1;if(e.y>=h){let r=.5*t[0].width;L.current.waters.some(t=>e.x>=t.x&&e.x<=t.x+t.size*r)?i("artillerySplashSfx"):(M.forEach((r,t)=>setTimeout(()=>{L.current.puffs.push({x:e.x-16,y:h-16,img:r,vy:0,age:0,maxAge:10,size:96})},50*t)),i("artilleryExplodeSfx")),c=!0}L.current.enemies.forEach(r=>{if(!c&&r.alive&&e.x>=r.x&&e.x<=r.x+135&&e.y>=r.y&&e.y<=r.y+101.25){r.alive=!1;H(300),L.current.enemyCount++,L.current.floatingScores.push({x:e.x,y:e.y,vy:-1,amount:300,age:0,maxAge:60}),M.forEach((e,t)=>setTimeout(()=>{L.current.puffs.push({x:r.x,y:r.y,img:e,vy:0,age:0,maxAge:10,size:96})},50*t)),i("artilleryExplodeSfx"),c=!0}});let m=R("duckTargetImgs");return L.current.ducks.forEach(r=>{if(!c&&!r.hit&&e.x>=r.x&&e.x<=r.x+r.width&&e.y>=r.y&&e.y<=r.y+r.height){r.hit=!0,r.fadeAge=0,r.fadeMax=60,r.targetImg=m[r.srcIdx],L.current.shotLakes.add(r.waterRef);H(1200),L.current.duckCount++,L.current.floatingScores.push({x:e.x,y:e.y,vy:-1,amount:1200,age:0,maxAge:60}),M.forEach((e,t)=>setTimeout(()=>{L.current.puffs.push({x:r.x,y:r.y,img:e,vy:0,age:0,maxAge:10,size:96})},50*t)),i("artilleryExplodeSfx"),c=!0}}),!c&&e.y<l+32}),!(L.current.artilleryShells.length>0)||L.current.artilleryPlaying||L.current.crashed?0===L.current.artilleryShells.length&&L.current.artilleryPlaying&&(c("artillerySfx"),L.current.artilleryPlaying=!1):(i("artillerySfx"),L.current.artilleryPlaying=!0),L.current.crashed&&L.current.artilleryPlaying&&(c("artillerySfx"),L.current.artilleryPlaying=!1);let P=R("fireImgs");L.current.napalmMissiles=L.current.napalmMissiles.filter(e=>{e.x+=e.vx,e.life--,++e.tailCounter>=5&&(e.tailCounter=0,e.tailFrame=(e.tailFrame+1)%P.length);let r=P[e.tailFrame],t=Math.atan2(0,e.vx),a=e.x-52*Math.cos(t),o=e.y-52*Math.sin(t);n.save(),n.translate(a,o),n.rotate(-Math.PI/2),n.drawImage(r,-r.width/2,-r.height/2,r.width,r.height),n.restore(),n.save(),n.translate(e.x,e.y),n.rotate(t),n.drawImage(e.img,-32,-32,64,64),n.restore();{let r=!1;for(let t of L.current.enemies)if(t.alive&&e.x>=t.x&&e.x<=t.x+135&&e.y>=t.y&&e.y<=t.y+101.25){r=!0,t.alive=!1,H(100),L.current.floatingScores.push({x:t.x+67.5,y:t.y+50.625,vy:-1,amount:100,age:0,maxAge:60});break}return r||e.x>=e.explodeX?(W(e.x,e.y,!1),!1):e.life>0&&e.x<s+64}});let A=[];L.current.napalmTiles=L.current.napalmTiles.filter(e=>{e.x-=L.current.groundSpeed(L.current.frameCount);let r=e.y+36-30>=h,s=.5*t[0].width,o=h-.5*t[0].height+120,u=L.current.waters.some(r=>{let t=r.x,a=r.x+r.size*s;return e.x>=t&&e.x<=a&&e.y+36>=o});r||u?(r?e.y=h-36+30:e.y=o-36,e.vy=0):(e.vy+=a,e.y+=e.vy),e.life--;let l=R("flameImgs"),m=l.length,g=l[Math.floor((e.maxLife-e.life)/e.maxLife*m)%m];return n.globalAlpha=e.life/e.maxLife,n.drawImage(g,e.x-36,e.y-36,72,72),n.globalAlpha=1,L.current.ducks=L.current.ducks.filter(r=>!!r.hit||!(e.x>=r.x)||!(e.x<=r.x+r.width)||!(e.y>=r.y)||!(e.y<=r.y+r.height)||(H(1e3),L.current.floatingScores.push({x:r.x+r.width/2,y:r.y+r.height/2,vy:-1,amount:1e3,age:0,maxAge:60}),L.current.napalmTiles.push({x:r.x+r.width/2,y:r.y+r.height/2,vy:0,life:600,maxLife:600,killsPlayer:!1}),L.current.shotLakes.has(r.waterRef)||L.current.shotLakes.add(r.waterRef),!1)),L.current.enemies=L.current.enemies.filter(r=>{if(r.alive&&e.x>=r.x&&e.x<=r.x+135&&e.y>=r.y&&e.y<=r.y+101.25){H(100),L.current.floatingScores.push({x:r.x+67.5,y:r.y+50.625,vy:-1,amount:100,age:0,maxAge:60});let e=r.x+67.5,t=r.y+50.625;return A.push({x:e,y:t}),!1}return!0}),L.current.medals=L.current.medals.filter(r=>!(e.x>=r.x)||!(e.x<=r.x+64)||!(e.y>=r.y)||!(e.y<=r.y+64)||(H(500),L.current.floatingScores.push({x:r.x+32,y:r.y+32,vy:-1,amount:500,age:0,maxAge:60}),L.current.napalmTiles.push({x:r.x+32,y:r.y+32,vy:0,life:600,maxLife:600,killsPlayer:!1}),!1)),e.killsPlayer&&!L.current.isActive("ghost",L.current.frameCount)&&!L.current.crashed&&e.x>=100&&e.x<=235&&e.y>=L.current.y&&e.y<=L.current.y+101.25&&(L.current.isActive("shield",L.current.frameCount)||L.current.isActive("supershield",L.current.frameCount)?(L.current.isActive("shield",L.current.frameCount)&&(L.current.activePowerups.shield.expires=0),L.current.shieldFlash=10,i("shieldSfx")):(L.current.crashed=!0,i("crashSfx"),c("flightSfx"))),e.life>0}),A.forEach(e=>{let{x:r,y:t}=e;W(r,t,!1)}),L.current.homingMissiles=L.current.homingMissiles.filter(e=>{if(e.target){let r=("x"in e.target?e.target.x:0)+67.5,t=Math.atan2(("y"in e.target?e.target.y:0)+50.625-e.y,r-e.x);e.vx=6*Math.cos(t),e.vy=6*Math.sin(t)}else e.vx=6,e.vy=0;e.x+=e.vx,e.y+=e.vy,++e.tailCounter>=5&&(e.tailCounter=0,e.tailFrame=(e.tailFrame+1)%2);let r=P[e.tailFrame],t=Math.atan2(e.vy,e.vx),a=e.x-16*Math.cos(t),s=e.y-16*Math.sin(t);for(let o of(n.save(),n.translate(a,s),n.rotate(t+Math.PI),n.drawImage(r,-r.width/2,-r.height/2,r.width,r.height),n.restore(),n.save(),n.translate(e.x,e.y),n.rotate(Math.atan2(e.vy,e.vx)),n.drawImage(e.img,-16,-16,32,32),n.restore(),L.current.enemies))if(o.alive&&e.x>=o.x&&e.x<=o.x+135&&e.y>=o.y&&e.y<=o.y+101.25){o.alive=!1,i("homingExplSfx");return H(200),L.current.floatingScores.push({x:e.x+50.625,y:e.y+67.5,vy:-1,amount:200,age:0,maxAge:60}),L.current.enemyCount++,M.forEach((r,t)=>setTimeout(()=>{L.current.puffs.push({x:e.x+50.625,y:e.y+67.5,img:r,vy:0,age:0,maxAge:10,size:96})},50*t)),!1}return!(--e.life<=0)||(i("homingExplSfx"),!1)}),(L.current.homingMissiles.length>0||L.current.napalmMissiles.length>0)&&!L.current.missileThrusterPlaying?(i("thrusterSfx"),L.current.missileThrusterPlaying=!0):0===L.current.homingMissiles.length&&0===L.current.napalmMissiles.length&&L.current.missileThrusterPlaying&&(c("thrusterSfx"),L.current.missileThrusterPlaying=!1),(L.current.activePowerups.bomb.expires===L.current.frameCount||L.current.activePowerups.bomb.expires===L.current.frameCount)&&(L.current.enemies.forEach(e=>{e.alive=!1;for(let r=0;r<5;r++)setTimeout(()=>X(e.x+67.5,e.y+50.625),50*r)}),i("bombSfx"),L.current.screenShake=20),L.current.falling.forEach((r,t)=>{r.vy+=a,r.y+=r.vy;let s=r.x+67.5,o=r.y+50.625,u=135*e,l=101.25*e;if(n.save(),n.translate(s,o),n.scale(-1,1),n.drawImage(r.img,-u/2,-l/2,u,l),n.restore(),.1>Math.random()&&X(s,o),r.y+101.25>=h){for(let e=0;e<5;e++)setTimeout(()=>X(s,h),100*e);L.current.falling.splice(t,1)}}),L.current.cannonballs.forEach((e,r)=>{e.x+=e.vx,n.drawImage(e.img,e.x,e.y,16,16),L.current.enemies.forEach(t=>{if(t.alive&&e.x>=t.x&&e.x<=t.x+135&&e.y>=t.y&&e.y<=t.y+101.25){t.alive=!1,M.forEach((r,t)=>setTimeout(()=>{L.current.puffs.push({x:e.x-16,y:e.y-16,img:r,vy:0,age:0,maxAge:10,size:96})},50*t));H(150),L.current.floatingScores.push({x:e.x+50.625,y:e.y+67.5,vy:-1,amount:150,age:0,maxAge:60}),L.current.cannonballs.splice(r,1)}}),e.x>s+50&&L.current.cannonballs.splice(r,1)});let S=R("laserBeamImgs");L.current.laserBeams=L.current.laserBeams.filter(e=>{e.x+=20,++e.frameCounter>=4&&(e.frameCounter=0,e.frame=(e.frame+1)%S.length);let r=S[e.frame];return n.save(),n.translate(e.x,e.y),n.rotate(Math.PI/2),n.drawImage(r,-r.width/2,-r.height/2,r.width,r.height),n.restore(),L.current.enemies.forEach(r=>{r.alive&&e.x>=r.x&&e.x<=r.x+135&&e.y>=r.y&&e.y<=r.y+101.25&&(r.alive=!1,H(100),L.current.floatingScores.push({x:r.x+67.5,y:r.y+50.625,vy:-1,amount:100,age:0,maxAge:60}),L.current.enemyCount++)}),e.x<s+50}),L.current.crashed&&L.current.groundCrashPuffsLeft>0&&(X(100,L.current.y+50.625),L.current.groundCrashPuffsLeft--);let _=[];if(L.current.puffs.forEach(e=>{var r;e.y+=e.vy,n.globalAlpha=1-e.age/e.maxAge;let t=null!=(r=e.size)?r:32;n.drawImage(e.img,e.x,e.y,t,t),n.globalAlpha=1,e.age++,e.age<e.maxAge&&_.push(e)}),L.current.puffs=_,L.current.floatingScores.forEach(e=>{n.globalAlpha=1-e.age/e.maxAge,n.drawImage(R("plusImg"),e.x-16,e.y-64,32,32);let r=e.x+18;if(void 0!=e.amount&&e.amount.toString().split("").forEach(t=>{let a=R("digitImgs")[t];a&&(n.drawImage(a,r,e.y-64,24,32),r+=26)}),L.current.isActive("coin2x",L.current.frameCount)){let t=R("powerupImgs");n.drawImage(t.coin2x,r,e.y-64,32,32)}e.y+=e.vy,e.age++}),L.current.floatingScores=L.current.floatingScores.filter(e=>e.age<e.maxAge),n.globalAlpha=1,.002>Math.random()){let e={x:s+200*Math.random(),y:h-32,size:3+Math.floor(5*Math.random()),frameIndex:0,frameCounter:0,frameRate:30},r=.5*t[0].width,a=.5*t[0].height,n=e.x,o=e.x+e.size*r;if(!L.current.waters.some(e=>{let t=e.x;return n<e.x+e.size*r&&t<o})){L.current.waters.push(e);let t=R("duckImgs"),n=R("duckTargetImgs"),s=R("duckOutlineImgs"),o=Math.floor(Math.random()*t.length),u=Math.floor(Math.random()*e.size),l=t[o],i=.5*l.width,c=.5*l.height,m=h-a+100;L.current.ducks.push({x:e.x+u*r,y:m-c,img:l,targetImg:n[o],outlineImg:s[o],width:i,height:c,srcIdx:o,bobPhase:Math.random()*Math.PI*2,vx:1.5,dir:.5>Math.random()?1:-1,waterRef:e})}}L.current.waters.forEach((e,r)=>{e.frameCounter++,e.frameCounter>=e.frameRate&&(e.frameCounter=0,e.frameIndex=+(0===e.frameIndex));let a=t[e.frameIndex],o=.5*a.width,u=.5*a.height;for(let r=0;r<e.size;r++)n.drawImage(a,e.x+r*o,h-u+100,o,u);e.x-=L.current.groundSpeed(L.current.frameCount),e.x+e.size*o+s<0&&L.current.waters.splice(r,1)}),L.current.isActive("supermag",L.current.frameCount)||L.current.isActive("napalm",L.current.frameCount)||L.current.crashed||L.current.waters.forEach(e=>{if(!L.current.ducks.some(r=>r.waterRef===e)&&!L.current.shotLakes.has(e)){let r=R("duckImgs"),a=R("duckTargetImgs"),n=R("duckOutlineImgs"),s=.5*t[0].width,o=Math.floor(Math.random()*r.length),u=r[o],l=.5*u.width,i=.5*u.height,c=e.x+(e.size*s-l)/2;L.current.ducks.push({x:c,y:h-i,img:u,targetImg:a[o],outlineImg:n[o],width:l,height:i,srcIdx:o,bobPhase:Math.random()*Math.PI*2,vx:1.5,dir:.5>Math.random()?1:-1,waterRef:e})}}),L.current.ducks.forEach((e,r)=>{e.x-=L.current.groundSpeed(L.current.frameCount);let a=e.y;if(e.hit||L.current.isActive("supermag",L.current.frameCount)||(a+=5*Math.sin(.05*L.current.frameCount+e.bobPhase)+20),!e.hit&&!L.current.isActive("supermag",L.current.frameCount)){let r=.5*t[0].width,a=e.waterRef.x,n=e.waterRef.x+e.waterRef.size*r;e.x+=e.vx*e.dir,e.x<=a?(e.x=a,e.dir=1):e.x+e.width>=n&&(e.x=n-e.width,e.dir=-1)}let o=L.current.isActive("megaducks",L.current.frameCount);a=o?a-20:a;let u=o?3:L.current.isActive("ducksight",L.current.frameCount)?1.33:1,l=e.width*u,i=e.height*u,c=e.x-(l-e.width)/2,m=a-(i-e.height)/2;if(e.hit&&e.targetImg)n.globalAlpha=1-e.fadeAge/e.fadeMax,e.y-=.5,n.save(),e.dir<0?(n.translate(c+l/2,m+i/2),n.scale(-1,1),n.drawImage(e.targetImg,-l/2,-i/2,l,i)):n.drawImage(e.targetImg,c,m,l,i),n.restore(),n.restore(),e.fadeAge++,e.fadeAge>=e.fadeMax&&L.current.ducks.splice(r,1),n.globalAlpha=1;else{let r=L.current.isActive("ducksight",L.current.frameCount);n.save(),e.dir<0?(n.translate(c+l/2,m+i/2),n.scale(-1,1),n.drawImage(r?e.outlineImg:e.img,-l/2,-i/2,l,i)):n.drawImage(r?e.outlineImg:e.img,c,m,l,i),n.restore()}(e.x+e.width<-50||e.x>s+50)&&L.current.ducks.splice(r,1)});let G=R("sparkImgs");L.current.sparkEffects.forEach(e=>{e.age++,e.frameIndex=Math.floor(e.age/e.maxAge*G.length),e.frameIndex>=G.length&&(e.frameIndex=G.length-1);let r=G[e.frameIndex];n.save(),n.globalAlpha=.8-e.age/e.maxAge*.8,n.filter="hue-rotate(-30deg) brightness(1.2)",n.globalCompositeOperation="lighter",n.drawImage(r,e.x,e.y,64,128),n.restore()}),L.current.sparkEffects=L.current.sparkEffects.filter(e=>e.age<e.maxAge),r.current=requestAnimationFrame(y),D()};y()},[R,N,Y,i,D,H,q,J,$,c,X,U,W]);(0,a.useEffect)(()=>{if("playing"===B.phase&&0===L.current.frameCount){O.current=!1,Z(),L.current.dynamicDensity=.01;let e=setInterval(()=>{L.current.dynamicDensity+=.005},45e3);return()=>clearInterval(e)}},[B.phase,Z]),(0,a.useEffect)(()=>{if("ready"===B.phase||"go"===B.phase){let r,t=e.current,a=null==t?void 0:t.getContext("2d");if(!t||!a)return;let{width:n,height:s}=N,u=window.devicePixelRatio||1;t.width=n*u,t.height=s*u,t.style.width="".concat(n,"px"),t.style.height="".concat(s,"px"),a.scale(u,u);let l=()=>{a.fillStyle=o,a.fillRect(0,0,n,s),L.current.textLabels=(0,F.drawTextLabels)({textLabels:L.current.textLabels,ctx:a,cull:!0}),r=requestAnimationFrame(l)};return l(),()=>cancelAnimationFrame(r)}},[B.phase,N,e]);let ee=(0,a.useCallback)(()=>{i("gameOverSfx"),Q()},[i,Q]);return(0,a.useEffect)(()=>{let e=e=>{"Space"===e.code&&"title"===L.current.phase&&Q()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ee,Q]),(0,a.useEffect)(()=>()=>{r.current&&cancelAnimationFrame(r.current)},[]),{ui:B,setUI:z,canvasRef:e,state:L,startSplash:Q,handleClick:r=>{if("playing"!==B.phase||B.crashed||B.ammo<=0){if(L.current.ammo<=1){let e=N.height/2;for(let r=0;r<3;r++)window.setTimeout(()=>U("RELOAD",2,!0,!0,100,e,30),200*r)}return}let t=L.current.isActive("spray",L.current.frameCount),a=t?Math.min(1,L.current.ammo):1,n=L.current.isActive("infiniteAmmo",L.current.frameCount)?L.current.ammo:Math.max(0,L.current.ammo-a);L.current.ammo=n,L.current.isActive("blindfold",L.current.frameCount)||(L.current.cursor=l,setTimeout(()=>{L.current.isActive("blindfold",L.current.frameCount)||(L.current.cursor=u)},100));let s=e.current.getBoundingClientRect(),o=r.clientX-s.left,i=r.clientY-s.top;if(t)for(let e=0;e<5;e++){let r=(2*Math.random()-1)*40,t=(2*Math.random()-1)*40;window.setTimeout(()=>K(o+r,i+t),50*e)}else K(o,i)},handleContext:e=>{e.preventDefault(),"playing"===L.current.phase&&!L.current.crashed&&L.current.ammo<12&&(i("reloadSfx"),H(25),L.current.ammo=12,L.current.floatingScores.push({x:Math.random()*N.width,y:Math.random()*N.height,vy:-1,amount:25,age:0,maxAge:60}))},getImg:R,isActive:V,resetGame:ee,resetState:Y,ready:T}};function T(){let{ui:e,canvasRef:t,handleClick:s,handleContext:l,resetGame:i,getImg:m,startSplash:h,ready:g}=R(),[p,f]=(0,a.useState)(!1),x=(0,a.useCallback)(()=>{g?h():f(!0)},[g,h]);(0,a.useEffect)(()=>{g&&p&&(h(),f(!1))},[g,p,h]);let{phase:y}=e;return"title"===y?(0,r.jsx)(c,{onStart:x,titleSrc:(0,n.withBasePath)("/assets/titles/warbirds_title.png"),backgroundColor:o,cursor:u}):(0,r.jsx)(d,{ui:e,canvasRef:t,handleClick:s,handleContext:l,resetGame:i,getImg:m})}function N(){return(0,r.jsx)(t.Container,{sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:(0,r.jsx)(T,{})})}}]);