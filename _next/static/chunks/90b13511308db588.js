(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,57512,e=>{"use strict";e.s(["BASE_PATH",()=>t,"withBasePath",()=>r]);let t="/portfolio";function r(e){let r=t.endsWith("/")?t.slice(0,-1):t,n=e.startsWith("/")?e:"/".concat(e);return"".concat(r).concat(n)}},57172,e=>{"use strict";e.s(["Container",()=>t.default]);var t=e.i(54526)},93010,83826,e=>{"use strict";e.s(["useWindowSize",()=>r],93010);var t=e.i(71645);function r(){let[e,r]=(0,t.useState)({width:0,height:0});return(0,t.useEffect)(()=>{function e(){r({width:window.innerWidth,height:window.innerHeight})}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),e}function n(e){let{textLabels:t,ctx:r,offsetX:n,offsetY:l,cull:a}=e,s=r.globalAlpha,i=r.fillStyle;return t.forEach(e=>{var t,a,s;r.globalAlpha=e.fade?1-e.age/e.maxAge:1,r.fillStyle=null!=(t=e.color)?t:i;let u=e.fixed?e.x:e.x-(n||0);for(let t of e.imgs)if(t){let n=t.width*e.scale,a=t.height*e.scale;r.drawImage(t,u,e.y-(l||0),n,a),u+=n+2}else u+=e.spaceGap;e.y+=null!=(a=e.vy)?a:0,e.scale+=null!=(s=e.vs)?s:0,e.age++}),r.globalAlpha=s,r.fillStyle=i,a&&(t=t.filter(e=>e.age<e.maxAge)),t}function l(e,t,r){let{text:n,scale:l,fixed:a,fade:s,x:i,y:u,py:c,vy:o,vs:h,maxAge:d,onClick:g,color:m}=e,{spaceGap:f}=e,{getImg:p}=t;if(!p)throw Error("Asset manager does not have getImg method");let y=p("letterImgs"),b=p("numberImgs"),v=p("digitImgs"),x=p("plusImg"),w=p("minusImg"),_=0;f=f||y&&1.5*y.A.width*l||10;let M=[];return Array.from(n).forEach(e=>{if(" "===e)_+=f,M.push(null);else{let t="+"===e?x:"-"===e?w:(null==y?void 0:y[e.toUpperCase()])||(null==b?void 0:b[e])||(null==v?void 0:v[e]);t&&(_+=t.width*l+2,M.push(t))}}),{text:n,imgs:M,scale:l,fixed:a,fade:s,x:null!=i?i:(null==r?void 0:r.width)!==void 0?(r.width-_)/2:0,y:(null!=u?u:(null==r?void 0:r.height)!==void 0?.2*r.height:0)+(null!=c?c:0),py:null!=c?c:0,vy:null!=o?o:0,vs:null!=h?h:0,age:0,maxAge:d||(s?60:1/0),spaceGap:f,...m?{color:m}:{},...g?{onClick:g}:{}}}e.s(["drawTextLabels",()=>n,"newTextLabel",()=>l],83826)},29338,e=>{"use strict";e.s(["default",()=>y],29338);var t=e.i(43476),r=e.i(57172),n=e.i(71645),l=e.i(57512);let a="url('".concat(l.BASE_PATH,"/assets/shooting-gallery/PNG/HUD/crosshair_blue_small.png') 16 16, auto"),s="url('".concat(l.BASE_PATH,"/assets/shooting-gallery/PNG/HUD/crosshair_white_small.png') 16 16, auto"),i="url('".concat(l.BASE_PATH,"/assets/shooting-gallery/PNG/HUD/crosshair_red_small.png') 16 16, auto");var u=e.i(63665);let c=e=>{let{onStart:r,titleSrc:l,backgroundColor:a,cursor:s}=e,i=(0,n.useRef)(null),c=(0,n.useRef)(null),o=(0,n.useRef)(!0);return(0,t.jsxs)(u.default,{position:"relative",width:"100vw",height:"100dvh",sx:{backgroundColor:a,cursor:s},display:"flex",justifyContent:"center",alignItems:"center",onClick:()=>{o.current=!1,c.current&&cancelAnimationFrame(c.current),r()},children:[(0,t.jsx)("canvas",{ref:i,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none"}}),(0,t.jsx)(u.default,{component:"img",src:l,alt:"Zombiefish",sx:{width:"auto",height:"100%",cursor:s}})]})},o=function(e){let{ui:r,canvasRef:n,handleClick:a,handleContext:s,handleMouseMove:i}=e,{phase:c,cursor:o}=r;return(0,t.jsxs)(u.default,{position:"relative",width:"100vw",height:"100dvh",children:[(0,t.jsx)("canvas",{ref:n,onClick:a,onContextMenu:s,onTouchStart:e=>{e.preventDefault();let t=e.touches[0];a({clientX:t.clientX,clientY:t.clientY})},onMouseMove:i,style:{display:"block",width:"100%",height:"100%",cursor:o}}),"gameover"===c&&(0,t.jsx)(u.default,{component:"img",src:(0,l.withBasePath)("/assets/shooting-gallery/PNG/HUD/text_gameover.png"),alt:"Game Over",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:300,height:"auto",pointerEvents:"none"}})]})};var h=e.i(93010),d=e.i(83826);let g=(()=>{let e=[0,3,6,9].map(e=>"jingles_NES".concat(e.toString().padStart(2,"0"))),t=[...e].reverse(),r=[];for(let n=0;n<2;n++)r.push(...e,"jingles_NES12",...t,"jingles_NES14");return r})(),m=(e,t)=>{if(Math.abs(e)>=Math.abs(t)){let r=.5*Math.abs(e);return{vx:e,vy:Math.max(Math.min(t,r),-r)}}let r=.5*Math.abs(t);return{vx:Math.max(Math.min(e,r),-r),vy:t}},f=(e,t)=>{let r=Math.atan2(t,e),n=!1;return r>Math.PI/2?(r=Math.PI-r,n=!0):r<-Math.PI/2&&(r=-Math.PI-r,n=!0),{angle:r,flipped:n}};function p(){let{ui:e,canvasRef:r,handleMouseMove:u,handleClick:p,handleContext:y,startSplash:b,ready:v}=function(){let e=(0,n.useRef)(null),t=(0,n.useRef)(null),r=function(){let[e,t]=(0,n.useState)(!1),r=(0,n.useRef)({});return(0,n.useEffect)(()=>{let e=e=>{let t=new window.Image;return t.src=(0,l.withBasePath)(e),t},n=(t,r)=>Object.fromEntries(r.map(r=>[r,e("/assets/fish/PNG/".concat(t,"/").concat(r,".png"))])),a=e("/assets/fish/Spritesheet/spritesheet.png"),s={blue:[[1152,256]],brown:[[1024,1280]],green:[[1024,1024]],grey:[[1024,512]],grey_long_a:[[1024,384]],grey_long_b:[[1024,128]],orange:[[896,1280]],pink:[[896,768]],red:[[896,256]]},i={blue:[[1152,0]],green:[[1024,768]],orange:[[896,1024]],pink:[[896,512]],red:[[896,0]]};a.onload=()=>{let e=e=>Object.fromEntries(Object.entries(e).map(e=>{let[t,r]=e;return[t,r.map(e=>{let[t,r]=e,n=document.createElement("canvas");n.width=128,n.height=128;let l=n.getContext("2d");null==l||l.drawImage(a,t,r,128,128,0,0,128,128);let s=new window.Image;return s.src=n.toDataURL(),s})]}));r.current.fishFrames=e(s),r.current.skeletonFrames=e(i),t(!0)},r.current.fishImgs=Object.fromEntries(["blue","brown","brown_outline","green","grey","grey_long_a","grey_long_a_outline","grey_long_b","grey_long_b_outline","orange","pink","red"].map(t=>[t,e("/assets/fish/PNG/Objects/Fish/fish_".concat(t,".png"))])),r.current.fishFlashImg=e("/assets/smoke/PNG/Flash/flash00.png"),r.current.bubbleImgs=n("Objects/Bubbles",["bubble_a","bubble_b","bubble_c"]),r.current.seaGrassImgs=n("Objects/SeaGrass",["seaweed_grass_a","seaweed_grass_a_outline","seaweed_grass_b","seaweed_grass_b_outline"]);let u=[];"abcd".split("").forEach(e=>{u.push("seaweed_green_".concat(e)),u.push("seaweed_green_".concat(e,"_outline"))}),"ab".split("").forEach(e=>{u.push("seaweed_orange_".concat(e)),u.push("seaweed_orange_".concat(e,"_outline"))}),"abcd".split("").forEach(e=>{u.push("seaweed_pink_".concat(e)),u.push("seaweed_pink_".concat(e,"_outline"))}),r.current.seaweedImgs=n("Objects/Seaweed",u),r.current.surfaceImgs=[e("/assets/shooting-gallery/PNG/Stall/water1.png"),e("/assets/shooting-gallery/PNG/Stall/water2.png")],r.current.cloudImgs=[e("/assets/shooting-gallery/PNG/Stall/cloud1.png"),e("/assets/shooting-gallery/PNG/Stall/cloud2.png")];let c="abcdefgh".split(""),o=["terrain_dirt_a","terrain_dirt_b","terrain_dirt_c","terrain_dirt_d",...c.flatMap(e=>["terrain_dirt_top_".concat(e),"terrain_dirt_top_".concat(e,"_outline")])],h=["terrain_sand_a","terrain_sand_b","terrain_sand_c","terrain_sand_d",...c.flatMap(e=>["terrain_sand_top_".concat(e),"terrain_sand_top_".concat(e,"_outline")])];r.current.terrainDirtImgs=n("Terrain/Dirt",o),r.current.terrainSandImgs=n("Terrain/Sand",h),r.current.terrainWaterImgs=n("Terrain/Water",["water_terrain","water_terrain_top"]),r.current.digitImgs={};for(let t=0;t<=9;t++)r.current.digitImgs[t.toString()]=e("/assets/fish/PNG/HUDText/hud_number_".concat(t,".png"));r.current.digitImgs[":"]=e("/assets/fish/PNG/HUDText/hud_colon.png"),r.current.letterImgs={};for(let t=65;t<=90;t++){let n=String.fromCharCode(t);r.current.letterImgs[n]=e("/assets/tappyplane/PNG/Letters/letter".concat(n,".png"))}r.current.dotImg=e("/assets/fish/PNG/HUDText/hud_dot.png"),r.current.pctImg=e("/assets/fish/PNG/HUDText/hud_percent.png"),r.current.plusImg=e("/assets/fish/PNG/HUDText/hud_plus.png");let d=document.createElement("canvas");d.width=r.current.plusImg.width||32,d.height=r.current.plusImg.height||32;let g=d.getContext("2d");if(g){g.fillStyle="white";let e=Math.max(1,Math.floor(d.height/5)),t=Math.floor((d.height-e)/2);g.fillRect(0,t,d.width,e)}let m=new window.Image;m.src=d.toDataURL(),r.current.minusImg=m},[]),{get:(0,n.useCallback)(e=>r.current[e],[]),getImg:(0,n.useCallback)(e=>{var t;return null!=(t=r.current[e])?t:void 0},[]),assetRefs:r.current,ready:e}}(),{getImg:u,ready:c}=r,o=function(){let e=(0,n.useMemo)(()=>{if("undefined"==typeof Audio)return{};let e=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=document.createElement("audio");return r.src=(0,l.withBasePath)(e),r.preload="auto",r.loop=t,r},t={shoot:e("/audio/laser4.ogg"),hit:e("/audio/laser9.ogg"),bonus:e("/audio/powerUp8.ogg"),penalty:e("/audio/error_004.ogg"),skeleton:e("/audio/splash.ogg"),death:e("/audio/lowDown.ogg"),convert:e("/audio/zap1.ogg"),pop:e("/audio/glass_001.ogg"),tick:e("/audio/tick_002.ogg"),warning:e("/audio/warning.ogg")};for(let r=0;r<=16;r++){let n="jingles_NES".concat(r.toString().padStart(2,"0"));t[n]=e("/audio/".concat(n,".ogg"))}return t},[]),t=(0,n.useCallback)((t,r)=>{let n=e[t];n&&((null==r?void 0:r.loop)!==void 0&&(n.loop=r.loop),(null==r?void 0:r.volume)!==void 0&&(n.volume=r.volume),n.currentTime=0,n.play())},[e]),r=(0,n.useCallback)(t=>{let r=e[t];r&&r.pause()},[e]),a=(0,n.useRef)({current:void 0,handler:void 0}),s=(0,n.useCallback)(()=>{Object.values(e).forEach(e=>e.pause());let t=a.current;(null==t?void 0:t.current)&&t.handler&&t.current.removeEventListener("ended",t.handler),a.current={current:void 0,handler:void 0}},[e]),i=(0,n.useCallback)((t,r)=>{if(!t.length)return;let n=0,l=()=>{let s=e[t[n]];if(!s)return;(null==r?void 0:r.volume)!==void 0&&(s.volume=r.volume),s.currentTime=0;let i=()=>{if(s.removeEventListener("ended",i),(n+=1)>=t.length)if(null==r?void 0:r.loop)n=0;else{a.current={current:void 0,handler:void 0};return}l()};a.current={current:s,handler:i},s.addEventListener("ended",i),s.play()};l()},[e]);return(0,n.useMemo)(()=>({play:t,playSequence:i,pause:r,pauseAll:s}),[t,i,r,s])}(),p=(0,h.useWindowSize)(),y=(0,n.useRef)({phase:"title",timer:99,shots:0,hits:0,score:0,accuracy:0,cursor:a,dims:p,fish:[],bubbles:[],textLabels:[],missParticles:[],conversions:0,hitCounts:{},warningPlayed:!1}),b=(0,n.useRef)(1),v=(0,n.useRef)(1),x=(0,n.useRef)(1),w=(0,n.useRef)(1),_=(0,n.useRef)({}),M=(0,n.useRef)([]),k=(0,n.useRef)([]),I=(0,n.useRef)(0),S=(0,n.useRef)(null),E=(0,n.useRef)(null),T=(0,n.useRef)(0),C=(0,n.useRef)(null),P=(0,n.useRef)(1e3*Math.random()),R=(0,n.useRef)(null),L=(0,n.useRef)(null),A=(0,n.useRef)(null),j=(0,n.useRef)(0),N=(0,n.useRef)(0),G=(0,n.useRef)(null),O=(0,n.useRef)(null),D=(0,n.useRef)(null),F=(0,n.useRef)(null),H=(0,n.useRef)(null),U=(0,n.useRef)(null),z=(0,n.useRef)(null),B=(0,n.useRef)(null),W=(0,n.useRef)({x:0,y:0,width:0,height:0}),[q,X]=(0,n.useState)({phase:"title",timer:99,shots:0,hits:0,score:0,accuracy:0,cursor:a});(0,n.useEffect)(()=>{y.current.dims=p},[p]);let Y=(0,n.useCallback)(e=>{y.current.cursor=e,X({phase:y.current.phase,timer:y.current.timer,shots:y.current.shots,hits:y.current.hits,score:y.current.score,accuracy:y.current.accuracy,cursor:e})},[]),K=(0,n.useCallback)((e,t,r,n)=>{let l=(0,d.newTextLabel)({text:e,scale:1,fixed:!0,fade:!0,x:t,y:r,vy:-.5,...n?{color:n}:{}},{getImg:u},y.current.dims);y.current.textLabels.push(l)},[u]),Z=(0,n.useCallback)(()=>{let{width:e,height:t}=y.current.dims,r=document.createElement("canvas");r.width=e,r.height=t;let n=r.getContext("2d");n&&function(e,t,r,n){let l,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=(l=1e3*r+7*n+13*a,()=>{let e=1e4*Math.sin(l++);return e-Math.floor(e)}),i=(e,t)=>e?Object.entries(e).filter(e=>{let[r]=e;return!r.endsWith("_outline")&&(!t||t(r))}).map(e=>{let[,t]=e;return t}):[],u=t("terrainWaterImgs"),c=t("terrainSandImgs"),o=t("terrainDirtImgs"),h=t("terrainRockImgs"),d=null==u?void 0:u.water_terrain,g=(null==u?void 0:u.water_terrain_top)||d,m=(null==d?void 0:d.width)||(null==g?void 0:g.width)||128,f=(null==d?void 0:d.height)||(null==g?void 0:g.height)||128,p=Math.ceil(r/m),y=i(c,e=>!e.includes("_top")),b=i(c,e=>e.includes("_top")),v=[...i(o,e=>!e.includes("_top")),...i(h,e=>!e.includes("_top"))],x=[...i(o,e=>e.includes("_top")),...i(h,e=>e.includes("_top"))],w=[],_=[],M=.65*n,k=.4*f,I=.3*f,S=s()*Math.PI*2,E=s()*Math.PI*2;for(let e=0;e<p;e++){let t=.5*e,r=M+Math.sin(t+S)*k,n=r+2*f+Math.sin(.8*t+E)*I;w.push(r),_.push(n)}if(d)for(let t=0;t<p;t++){let r=t*m,n=Math.ceil(w[t]/f);n%2==1&&(n+=1);for(let t=0;t<n-1;t++)e.drawImage(d,r,t*f,m,f);g&&e.drawImage(g,r,(n-1)*f,m,f)}else e.fillStyle="#1d8fde",e.fillRect(0,0,r,n);let T=[];for(let t=0;t<p;t++){let r=t*m,l=w[t],a=Math.min(_[t],n-f);for(let t=a;t<n;t+=f){let n=v[Math.floor(s()*v.length)];n&&e.drawImage(n,r,t,m,f)}let i=x[Math.floor(s()*x.length)];i&&T.push({img:i,x:r,y:a-f});for(let t=l;t<a;t+=f){let n=y[Math.floor(s()*y.length)];n&&e.drawImage(n,r,t,m,f)}let u=b[Math.floor(s()*b.length)];u&&T.push({img:u,x:r,y:l-f})}let C=e=>i(t(e)),P=[...C("seaweedImgs"),...C("seaGrassImgs"),...C("coralImgs"),...C("rockImgs")],R=[],L=.8*m,A=Math.min(P.length,Math.floor(r/(1.5*m)));for(let t=0;t<A;t++){let t=null;for(let e=0;e<20;e++){let e=s()*r;if(R.every(t=>Math.abs(t-e)>L)){t=e;break}}if(null===t)continue;R.push(t);let n=P[Math.floor(s()*P.length)],l=Math.min(Math.floor(t/m),p-1),a=.3>s()?_[l]:w[l],i=.5+.7*s(),u=.5>s()?-1:1,c=s()*((null==n?void 0:n.height)||0)*.3;e.save(),e.translate(t,a),e.scale(u*i,i),e.drawImage(n,-n.width/2,-n.height+c),e.restore()}T.sort((e,t)=>t.y-e.y),T.forEach(t=>e.drawImage(t.img,t.x,t.y,m,f))}(n,u,e,t,P.current),R.current=r},[u]),J=(0,n.useCallback)(e=>{let{width:t,height:r}=y.current.dims,n=R.current;n&&n.width===t&&n.height===r||Z(),R.current&&e.drawImage(R.current,0,0)},[Z]),Q=(0,n.useCallback)(function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(!e)return;let l=(r>0?t.toString().padStart(r,"0"):t.toString())+n,a=u("digitImgs");e.text=l,e.imgs=l.split("").map(e=>a[e])},[u]),V=(0,n.useCallback)((e,t)=>{if(Q(e,t),!e)return;let r=e.imgs.reduce((t,r)=>t+((null==r?void 0:r.width)||0)*e.scale+2,0),n=e.imgs.reduce((t,r)=>Math.max(t,((null==r?void 0:r.height)||0)*e.scale),0);e.x=p.width-r-16,e.y=p.height-n-16},[Q,p]);(0,n.useEffect)(()=>{V(D.current,y.current.score)},[p,V]);let $=(0,n.useCallback)(()=>{let t=y.current,{width:r,height:n}=t.dims,l=u("fishFlashImg"),a=e.current,s=null==a?void 0:a.getContext("2d");t.fish.forEach(e=>{let t=u(e.isSkeleton?"skeletonFrames":"fishFrames")[e.kind];t&&t.length>0&&(e.frameCounter+=1,e.frameCounter>=6&&(e.frameCounter=0,e.frame=(e.frame+1)%t.length)),e.pendingSkeleton&&(s&&l&&s.drawImage(l,e.x,e.y,128,128),e.flashTimer=(e.flashTimer||0)-1,e.flashTimer<=0&&(e.isSkeleton=!0,e.health=2,e.hurtTimer=0,e.pendingSkeleton=void 0,e.flashTimer=void 0))});let i={};t.fish.forEach(e=>{var t;if(void 0===e.groupId)return;let r=i[t=e.groupId]||(i[t]={vx:0,vy:0,members:[]});r.vx+=e.vx,r.vy+=e.vy,r.members.push(e)});let c=_.current;Object.entries(i).forEach(e=>{let[t,r]=e,n=Number(t),l=m(r.vx/r.members.length,r.vy/r.members.length),a=c[n],s=a&&Math.abs(Math.atan2(l.vx*a.vy-l.vy*a.vx,l.vx*a.vx+l.vy*a.vy))>.2;r.members.forEach(e=>{e.vx=l.vx,e.vy=l.vy,s&&(e.wanderTimer=Math.floor(60*Math.random())+60)}),c[n]={vx:l.vx,vy:l.vy}}),Object.keys(c).forEach(e=>{let t=Number(e);i[t]||delete c[t]});let h={};t.fish.forEach(e=>{var t;if(void 0===e.pairId)return;let r=h[t=e.pairId]||(h[t]={});"grey_long_a"===e.kind?r.a=e:"grey_long_b"===e.kind&&(r.b=e)}),Object.values(h).forEach(e=>{let{a:t,b:r}=e;if(!t||!r)return;r.vy=t.vy;let n=t.vx>=0?1:-1,l=t.x+128*n-r.x;r.vx+=.05*l});let d=new Set(["brown","grey_long_a","grey_long_b"]),g=1048576,p=t.fish.filter(e=>e.isSkeleton||e.pendingSkeleton).length,b=t.fish.filter(e=>e.isSkeleton);b.forEach((e,r)=>{let n,l=g;for(let r of t.fish){if(r.isSkeleton||r.pendingSkeleton||d.has(r.kind))continue;let t=r.x-e.x,a=r.y-e.y,s=t*t+a*a;s<l&&(l=s,n=r)}if(!n){e.vx=0,e.vy=0;return}let a=n.x-e.x,s=n.y-e.y,i=Math.sqrt(l);i>0&&(e.vx=a/i*2,e.vy=s/i*2),i<64&&p<20&&!n.pendingSkeleton&&(K("POOF",n.x,n.y),n.pendingSkeleton=!0,n.flashTimer=5,n.vx=0,n.vy=0,n.frame=0,n.frameCounter=0,delete n.groupId,t.conversions+=1,o.play("convert"),p+=1);for(let t=0;t<b.length;t++){if(t===r)continue;let n=b[t],l=n.x-e.x,a=n.y-e.y,s=Math.sqrt(l*l+a*a);s>0&&s<128&&(e.vx-=l/s*.05,e.vy-=a/s*.05)}let u=m(e.vx,e.vy);e.vx=u.vx,e.vy=u.vy}),t.fish.forEach(e=>{if(!e.isSkeleton&&(e.wanderTimer-=1,e.wanderTimer<=0)){let t,r,n=(2*Math.random()+1)*ei();Math.abs(e.vx)>=Math.abs(e.vy)?(t=(e.vx>=0?1:-1)*n,r=(2*Math.random()-1)*n*.25):(r=(e.vy>=0?1:-1)*n,t=(2*Math.random()-1)*n*.25);let l=m(t,r);e.vx=l.vx,e.vy=l.vy,e.wanderTimer=Math.floor(60*Math.random())+60}}),t.fish.forEach(e=>{e.hurtTimer>0&&(e.hurtTimer-=1);let t=.5*Math.sin((T.current+e.id)/20),l=m(e.vx,e.vy+t);e.x+=l.vx,e.y+=l.vy;let a=f(l.vx,l.vy);e.angle=a.angle,e.flipped=a.flipped,e.isSkeleton&&(e.x=Math.max(0,Math.min(e.x,r-128)),e.y=Math.max(0,Math.min(e.y,n-128)))})},[o,K,u]),ee=(0,n.useCallback)(()=>{let{width:e,height:t}=y.current.dims,r=["bubble_a","bubble_b","bubble_c"],n=r[Math.floor(Math.random()*r.length)],l=64*Math.random()+32,a=Math.random()*(e-l),s=Math.random()-.5,i=+Math.random()+-1.5,u=2*Math.random()+.5,c=.05*Math.random()+.01;if(y.current.bubbles.length>=20)return;let o=k.current.pop()||{};o.id=w.current++,o.kind=n,o.x=a,o.y=t+l,o.vx=s,o.vy=i,o.size=l,o.amp=u,o.freq=c,y.current.bubbles.push(o)},[]),et=(0,n.useCallback)(()=>{var n,l,a;let s=y.current;if(O.current){let e=O.current,t=e.imgs.reduce((t,r)=>t+(r?r.width*e.scale+2:e.spaceGap),0),r=e.imgs.reduce((t,r)=>Math.max(t,((null==r?void 0:r.height)||0)*e.scale),0);e.x=(s.dims.width-t)/2,W.current={x:e.x,y:e.y-(null!=(n=e.py)?n:0),width:t,height:r+(null!=(l=e.py)?l:0)*2}}let i=e.current,c=null==i?void 0:i.getContext("2d");if(!i||!c){t.current=requestAnimationFrame(et);return}if("playing"===s.phase){if($(),I.current-=1,I.current<=0&&(ee(),I.current=Math.floor(60*Math.random())+30),s.bubbles.forEach(e=>{e.x+=e.vx+Math.sin(T.current*e.freq)*e.amp,e.y+=e.vy}),s.bubbles=s.bubbles.filter(e=>{let t=e.y+e.size>0&&e.x+e.size>0&&e.x-e.size<s.dims.width;return t||k.current.push(e),t}),T.current+=1,T.current>=60&&(T.current=0,s.timer=Math.max(0,s.timer-1),o.play("tick"),Q(O.current,s.timer,2),10!==s.timer||s.warningPlayed||(o.play("warning"),s.warningPlayed=!0)),0===s.timer){s.phase="gameover",j.current=s.shots>0?Math.round(s.hits/s.shots*100):0,(a=j.current)>Number(localStorage.getItem("bestAccuracy")||0)&&localStorage.setItem("bestAccuracy",a.toString()),N.current=0,o.pauseAll(),A.current&&(s.textLabels=s.textLabels.filter(e=>e!==A.current),A.current=null);let e=u("pctImg"),t=[u("digitImgs")["0"],e],n=t.reduce((e,t)=>e+ +t.width+2,0),l=(0,d.newTextLabel)({text:"0",scale:1,fixed:!0,fade:!1,x:(s.dims.width-n)/2,y:s.dims.height/2,py:8},r);l.text="0%",l.imgs=t,L.current=l,s.textLabels.push(l);let i=(e,t)=>{let n=(0,d.newTextLabel)({text:e,scale:1,fixed:!0,fade:!1,y:t,py:8},r,s.dims);return s.textLabels.push(n),n},c=l.y+40;z.current=i("TIME ".concat(s.timer.toString().padStart(2,"0")),c),H.current=i("SHOTS ".concat(s.shots),c+40),U.current=i("HITS ".concat(s.hits),c+80);let h=c+120;Object.entries(s.hitCounts).sort((e,t)=>{let[r]=e,[n]=t;return r.localeCompare(n)}).forEach(e=>{let[t,r]=e;i("".concat(t.replace(/_/g," ")," ").concat(r),h),h+=40}),B.current=i("SCORE ".concat(s.score),c+120)}if(!G.current){let e=Number(localStorage.getItem("bestAccuracy")||0),t=u("pctImg"),n=u("digitImgs"),l=(0,d.newTextLabel)({text:"".concat(e,"%"),scale:1,fixed:!0,fade:!1,x:16,y:16,py:8},r);l.imgs=[...e.toString().split("").map(e=>n[e]),t],G.current=l,s.textLabels.push(l)}let{width:e,height:t}=s.dims;s.fish=s.fish.filter(r=>{let n=r.x>-256&&r.x<e+256&&r.y>-256&&r.y<t+256;return n||M.current.push(r),n})}if(s.missParticles.forEach(e=>{e.radius+=4,e.alpha-=.05}),s.missParticles=s.missParticles.filter(e=>e.alpha>0),"gameover"===s.phase&&L.current){let e=L.current;if(N.current<j.current){N.current+=1,o.play("tick");let t=Math.min(N.current,j.current).toString(),r=u("digitImgs"),n=u("pctImg");e.text="".concat(t,"%"),e.imgs=[...t.split("").map(e=>r[e]),n]}e.scale=1+.05*Math.sin(.1*T.current);let t=e.imgs.reduce((t,r)=>t+((null==r?void 0:r.width)||0)*e.scale+2,0);e.x=(s.dims.width-t)/2}if("playing"===s.phase){let{width:e,height:t}=s.dims;s.fish=s.fish.filter(r=>{let n=r.x>-256&&r.x<e+256&&r.y>-256&&r.y<t+256;return n||M.current.push(r),n})}if("paused"===s.phase?F.current||(F.current=(0,d.newTextLabel)({text:"PAUSED",scale:2,fixed:!0,fade:!1},r,s.dims),s.textLabels.push(F.current)):F.current&&(s.textLabels=s.textLabels.filter(e=>e!==F.current),F.current=null),i&&c){i.width=s.dims.width,i.height=s.dims.height,c.clearRect(0,0,i.width,i.height),J(c);let e=s.timer/99*i.width;c.fillStyle="rgba(0,0,0,0.5)",c.fillRect(0,0,e,8);let t=u("bubbleImgs");s.bubbles.forEach(e=>{let r=t[e.kind];r&&c.drawImage(r,e.x,e.y,e.size,e.size)}),s.missParticles.forEach(e=>{c.beginPath(),c.arc(e.x,e.y,e.radius,0,2*Math.PI),c.strokeStyle="rgba(255,255,255,".concat(e.alpha,")"),c.lineWidth=2,c.stroke()}),s.fish.forEach(e=>{let t=u(e.isSkeleton?"skeletonFrames":"fishFrames")[e.kind];if(!t||0===t.length)return;let r=t[e.frame];if(!r)return;c.save();let n=e.x+64,l=e.y+64,a=-64;if(("grey_long_a"===e.kind||"grey_long_b"===e.kind)&&(n=e.x+128*("grey_long_a"===e.kind),a="grey_long_a"===e.kind?-128:0),c.translate(n,l),c.rotate(e.angle),e.flipped&&c.scale(-1,1),e.highlight){let t=u("fishImgs")["".concat(e.kind,"_outline")];t&&(c.globalAlpha=(Math.sin(T.current/10)+1)/2,c.drawImage(t,a,-64,128,128),c.globalAlpha=1)}if(c.drawImage(r,a,-64,128,128),e.pendingSkeleton||e.isSkeleton&&e.hurtTimer>0){let e=u("fishFlashImg");e&&c.drawImage(e,a,-64,128,128)}c.restore()}),s.textLabels=(0,d.drawTextLabels)({textLabels:s.textLabels,ctx:c,cull:!0})}if(s.accuracy=s.shots>0?s.hits/s.shots*100:0,A.current&&"playing"===s.phase){let e=A.current,t=Math.round(s.accuracy),r=u("digitImgs"),n=u("pctImg");e.text="".concat(t,"%"),e.imgs=[...t.toString().split("").map(e=>r[e]),n];let l=e.imgs.reduce((t,r)=>t+((null==r?void 0:r.width)||0)*e.scale+2,0);e.x=s.dims.width-l-16}X({phase:s.phase,timer:s.timer,shots:s.shots,hits:s.hits,score:s.score,accuracy:s.accuracy,cursor:s.cursor}),t.current=requestAnimationFrame(et)},[$,u,r,ee,Q]),er=(0,n.useCallback)(()=>{let e=y.current;e.phase="playing",e.timer=99,e.shots=0,e.hits=0,e.score=0,e.accuracy=0,M.current.push(...e.fish),e.fish=[],k.current.push(...e.bubbles),e.bubbles=[],e.missParticles=[],e.warningPlayed=!1,T.current=0,L.current=null,A.current=null,G.current=null,j.current=0,N.current=0,P.current=1e3*Math.random(),R.current=null,F.current=null,H.current=null,U.current=null,z.current=null,B.current=null;let n=u("digitImgs");o.playSequence(g,{loop:!0});let l=e=>e.imgs.reduce((t,r)=>t+(r?r.width+2:e.spaceGap),0),s=(0,d.newTextLabel)({text:"".concat(e.timer.toString().padStart(2,"0")),scale:1,fixed:!0,fade:!1,x:0,y:16,py:8},r);Q(s,e.timer,2),s.x=(e.dims.width-l(s))/2,O.current=s,W.current={x:s.x,y:s.y-((null==s?void 0:s.py)||0),width:l(s),height:s.imgs.reduce((e,t)=>Math.max(e,((null==t?void 0:t.height)||0)*s.scale),0)+2*((null==s?void 0:s.py)||0)},D.current=(0,d.newTextLabel)({text:e.score.toString(),scale:1,fixed:!0,fade:!1},r),V(D.current,e.score);let i=u("pctImg"),c=(0,d.newTextLabel)({text:"0%",scale:1,fixed:!0,fade:!1,x:0,y:16,py:8},r);c.imgs=[n["0"],i],c.x=e.dims.width-c.imgs.reduce((e,t)=>e+((null==t?void 0:t.width)||0)*c.scale+2,0)-16,A.current=c,I.current=0,y.current.textLabels=[O.current,D.current,c],e.cursor=a,X({phase:e.phase,timer:e.timer,shots:e.shots,hits:e.hits,score:e.score,accuracy:e.accuracy,cursor:e.cursor}),t.current&&cancelAnimationFrame(t.current),t.current=requestAnimationFrame(et)},[et,r,u,Q]),en=(0,n.useCallback)(()=>{let e=y.current;C.current&&(clearTimeout(C.current),C.current=null),e.phase="title",e.timer=99,e.shots=0,e.hits=0,e.score=0,e.accuracy=0,e.conversions=0,e.hitCounts={},M.current.push(...e.fish),e.fish=[],e.cursor=a,k.current.push(...e.bubbles),e.bubbles=[],e.missParticles=[],e.warningPlayed=!1,L.current=null,A.current=null,G.current=null,j.current=0,N.current=0,T.current=0,O.current=null,D.current=null,H.current=null,U.current=null,z.current=null,B.current=null,y.current.textLabels=[],I.current=0,b.current=1,v.current=1,x.current=1,w.current=1,P.current=1e3*Math.random(),R.current=null,F.current=null,X({phase:e.phase,timer:e.timer,shots:e.shots,hits:e.hits,score:e.score,accuracy:e.accuracy,cursor:e.cursor}),t.current&&cancelAnimationFrame(t.current),S.current&&(clearTimeout(S.current),S.current=null),E.current&&(clearTimeout(E.current),E.current=null),o.pauseAll()},[]);(0,n.useEffect)(()=>{let e=e=>{let t=y.current;if("Escape"===e.code&&("playing"===t.phase||"paused"===t.phase)){t.phase="playing"===t.phase?"paused":"playing",X({phase:t.phase,timer:t.timer,shots:t.shots,hits:t.hits,score:t.score,accuracy:t.accuracy,cursor:t.cursor});return}"gameover"===t.phase&&"Space"===e.code?(en(),er()):"title"===y.current.phase&&er()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[en,er]);let el=(0,n.useCallback)(t=>{let r=y.current;if("playing"!==r.phase||r.cursor===s)return;let n=e.current;if(!n)return;let{left:l,top:u,width:c,height:o}=n.getBoundingClientRect(),h=(t.clientX-l)/c*r.dims.width,d=(t.clientY-u)/o*r.dims.height,g=r.fish.some(e=>h>=e.x&&h<=e.x+128&&d>=e.y&&d<=e.y+128)?i:a;g!==r.cursor&&Y(g)},[Y]),ea=(0,n.useCallback)(t=>{var r,n;null==(r=t.preventDefault)||r.call(t);let l=y.current;if("gameover"===l.phase){en(),er();return}let i=e.current;if(!i)return void X({phase:l.phase,timer:l.timer,shots:l.shots,hits:l.hits,score:l.score,accuracy:l.accuracy,cursor:l.cursor});let u=i.getBoundingClientRect(),c=(t.clientX-u.left)/u.width*l.dims.width,h=(t.clientY-u.top)/u.height*l.dims.height,d=W.current;if(c>=d.x&&c<=d.x+d.width&&h>=d.y&&h<=d.y+d.height){("playing"===l.phase||"paused"===l.phase)&&(l.phase="playing"===l.phase?"paused":"playing",X({phase:l.phase,timer:l.timer,shots:l.shots,hits:l.hits,score:l.score,accuracy:l.accuracy,cursor:l.cursor}));return}if("playing"!==l.phase)return;Y(s),E.current&&clearTimeout(E.current),E.current=setTimeout(()=>{Y(a)},100),l.shots+=1,o.play("shoot");for(let e=l.bubbles.length-1;e>=0;e--){let t=l.bubbles[e];if(c>=t.x&&c<=t.x+t.size&&h>=t.y&&h<=t.y+t.size){let[t]=l.bubbles.splice(e,1);t&&k.current.push(t),o.play("pop"),l.accuracy=l.shots>0?l.hits/l.shots*100:0,X({phase:l.phase,timer:l.timer,shots:l.shots,hits:l.hits,score:l.score,accuracy:l.accuracy,cursor:l.cursor});return}}let g=!1;for(let e=l.fish.length-1;e>=0;e--){let t=l.fish[e];if(c>=t.x&&c<=t.x+128&&h>=t.y&&h<=t.y+128){l.hits+=1,l.hitCounts[t.kind]=(l.hitCounts[t.kind]||0)+1,o.play("hit"),g=!0;let r={brown:50,grey_long_a:5,grey_long_b:5},a=(t.isSkeleton?20:null!=(n=r[t.kind])?n:10)+l.conversions;if(l.score+=a,V(D.current,l.score),"brown"===t.kind){l.timer+=3,Q(O.current,l.timer,2),K("+".concat(3),t.x,t.y,"#0f0");let[r]=l.fish.splice(e,1);r&&M.current.push(r),o.play("bonus")}else if("grey_long_a"===t.kind||"grey_long_b"===t.kind){l.timer+=5,Q(O.current,l.timer,2),K("+".concat(5),t.x,t.y,"#f00");let r=t.pairId;if(void 0!==r){let e=l.fish.filter(e=>e.pairId===r);l.fish=l.fish.filter(e=>e.pairId!==r),M.current.push(...e)}else{let[t]=l.fish.splice(e,1);t&&M.current.push(t)}o.play("bonus")}else{let r=l.fish.filter(e=>e.isSkeleton||e.pendingSkeleton).length;if(t.isSkeleton)if(t.health-=1,t.health>0)t.hurtTimer=10,o.play("skeleton");else{let[t]=l.fish.splice(e,1);t&&M.current.push(t),o.play("death")}else if(.5>Math.random()&&r<20)t.isSkeleton=!0,t.health=1,t.hurtTimer=0,t.frame=0,t.frameCounter=0,delete t.groupId,o.play("skeleton");else{let[t]=l.fish.splice(e,1);t&&M.current.push(t),o.play("death")}}break}}g||l.missParticles.push({x:c,y:h,radius:0,alpha:1}),l.accuracy=l.shots>0?l.hits/l.shots*100:0,X({phase:l.phase,timer:l.timer,shots:l.shots,hits:l.hits,score:l.score,accuracy:l.accuracy,cursor:l.cursor})},[o,K,Q,en,er]),es=(0,n.useCallback)(e=>{e.preventDefault()},[]);function ei(){return 1+(1-y.current.timer/99)}let eu=(0,n.useCallback)((e,t)=>{if("skeleton"===e)return[];let r=[],{width:n,height:l}=y.current.dims,a=["brown"],s={grey_long:["grey_long_a","grey_long_b"]},i=Object.values(s).flat(),u=a.includes(e)||!!s[e],c=y.current.fish.filter(e=>a.includes(e.kind)||i.includes(e.kind)).length,o=y.current.fish.filter(e=>!e.isSkeleton&&!a.includes(e.kind)&&!i.includes(e.kind)).length;if(u){var h,d;if(c>=3||c+(null!=(d=null==(h=s[e])?void 0:h.length)?d:1)>3)return[];t=1}else{let e=30-o;if(e<=0)return[];t=Math.min(t,e)}t=Math.min(t,4);let g=[0,0,0,1,1,1],p=g[Math.floor(Math.random()*g.length)],w=()=>{let e,t=ei(),r=(2*Math.random()+1)*t,n=(2*Math.random()-1)*t;return m(e=0===p?r:-r,n)},_=function(e,t,r,n,l,a){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=M.current.pop()||{};i.id=b.current++,i.kind=e,i.x=t,i.y=r,i.vx=n,i.vy=l;let u=f(n,l);return i.angle=u.angle,i.flipped=u.flipped,i.frame=0,i.frameCounter=0,i.health=0,i.hurtTimer=0,i.isSkeleton=!1,i.groupId=a,i.pairId=void 0,i.highlight=!!s||void 0,i.pendingSkeleton=void 0,i.flashTimer=void 0,i.wanderTimer=Math.floor(60*Math.random())+60,i};if(s[e]){let t=x.current++,{vx:a,vy:i}=w(),u=0===p?-256:n-128,c=Math.random()*l;s[e].forEach((e,n)=>{let l=_(e,u+128*n,c,a,i);l.pairId=t,r.push(l)})}else{let s=0===p?-128:n+128,i=Math.random()*l,c=w(),o=t>1&&!a.includes(e)?v.current++:void 0;for(let n=0;n<t;n++){let t=s,a=i,h=c.vx,d=c.vy;if(void 0!==o&&n>0){a+=(Math.random()-.5)*128,t+=0===p?-(64*Math.random()):64*Math.random();let e=m(h+=(Math.random()-.5)*.5,d+=(Math.random()-.5)*.5);h=e.vx,d=e.vy}else a=Math.random()*l;let g=_(e,t,a,h,d,o,u&&0===n);r.push(g)}}return y.current.fish.push(...r),r},[]);return(0,n.useEffect)(()=>{if("playing"!==q.phase)return;let e=["blue","green","orange","pink","red"],t=()=>{let{timer:r,conversions:n}=y.current;C.current=setTimeout(()=>{if("playing"!==y.current.phase)return;eu(e[Math.floor(Math.random()*e.length)],Math.floor(5*Math.random())+1);let r=Math.random();r<.1?eu("brown",1):r<.15&&eu("grey_long",1),"playing"===y.current.phase&&t()},Math.max((1e3+2e3*Math.random())/(1+(1-r/99)+.1*n),250))};return t(),()=>{C.current&&(clearTimeout(C.current),C.current=null)}},[q.phase,eu]),(0,n.useEffect)(()=>()=>{t.current&&cancelAnimationFrame(t.current)},[]),{ui:q,canvasRef:e,handleMouseMove:el,handleClick:ea,handleContext:es,resetGame:en,startSplash:er,getImg:u,ready:c,spawnFish:eu}}(),[x,w]=(0,n.useState)(!1),_=(0,n.useCallback)(()=>{v?b():w(!0)},[v,b]);(0,n.useEffect)(()=>{v&&x&&(b(),w(!1))},[v,x,b]);let{phase:M}=e;return"title"===M?(0,t.jsx)(c,{onStart:_,titleSrc:(0,l.withBasePath)("/assets/titles/zombiefish_title.png"),backgroundColor:"#1d8fde",cursor:a}):(0,t.jsx)(o,{ui:e,canvasRef:r,handleClick:p,handleContext:y,handleMouseMove:u})}function y(){return(0,t.jsx)(r.Container,{sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:(0,t.jsx)(p,{})})}}]);